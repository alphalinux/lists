<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>SuSE AXP: [suse-axp] Re: RTC-Clock misfunction on AS 400</TITLE>
<META NAME="Author" CONTENT="Alex Rhomberg (rhomberg@ife.ee.ethz.ch)">
<META NAME="Subject" CONTENT="[suse-axp] Re: RTC-Clock misfunction on AS 400">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>[suse-axp] Re: RTC-Clock misfunction on AS 400</H1>
<HR>
<P>
<!-- received="Thu Mar 23 20:53:37 2000" -->
<!-- isoreceived="20000324045337" -->
<!-- sent="Thu, 23 Mar 2000 14:29:34 +0100" -->
<!-- isosent="20000323132934" -->
<!-- name="Alex Rhomberg" -->
<!-- email="rhomberg@ife.ee.ethz.ch" -->
<!-- subject="[suse-axp] Re: RTC-Clock misfunction on AS 400" -->
<!-- id="38DA1C3E.C3BEDBC9@ife.ee.ethz.ch" -->
<!-- inreplyto="Pine.LNX.4.21.0003231126520.7267-100000@fatou.suse.de" -->
<STRONG>Subject: </STRONG>[suse-axp] Re: RTC-Clock misfunction on AS 400<BR>
<STRONG>From: </STRONG>Alex Rhomberg (<EM>rhomberg@ife.ee.ethz.ch</EM>)<BR>
<STRONG>Date: </STRONG>Thu Mar 23 2000 - 05:29:34 PST
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#115">[ date ]</A>
<A HREF="index.html#115">[ thread ]</A>
<A HREF="subject.html#115">[ subject ]</A>
<A HREF="author.html#115">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0116.html">SDenningho@aol.com: "[suse-axp] X on Alphastation 400  - Problem Fixed"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0114.html">Alex Rhomberg: "[suse-axp] gettimeofday resolution"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0113.html">Ruediger Oertel: "Re: [suse-axp] Re: RTC-Clock misfunction on AS 400"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0118.html">Ruediger Oertel: "Re: [suse-axp] Re: RTC-Clock misfunction on AS 400"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0113.html">Alex Rhomberg: "[suse-axp] Re: RTC-Clock misfunction on AS 400"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Ruediger Oertel wrote:
<BR>
<P><EM>&gt; &gt; It's not only a Y2K-bug it seems to be a little bit bigger.
</EM><BR>
<EM>&gt; The correct fix should be (as posted by Andries Brouwer on l-k):
</EM><BR>
<EM>&gt; --- rtc.c~      Sat Mar 18 23:25:12 2000
</EM><BR>
<EM>&gt; +++ rtc.c       Mon Mar 20 14:48:48 2000
</EM><BR>
<EM>&gt; @@ -670,10 +670,10 @@
</EM><BR>
<EM>&gt;         if (!(ctrl &amp; RTC_DM_BINARY) || RTC_ALWAYS_BCD)
</EM><BR>
<EM>&gt;                 BCD_TO_BIN(year);       /* This should never happen... */
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; -       if (year &gt; 10 &amp;&amp; year &lt; 44) {
</EM><BR>
<EM>&gt; +       if (year &gt;= 20 &amp;&amp; year &lt; 48) {
</EM><BR>
<EM>&gt;                 epoch = 1980;
</EM><BR>
<EM>&gt;                 guess = &quot;ARC console&quot;;
</EM><BR>
<EM>&gt; -       } else if (year &lt; 96) {
</EM><BR>
<EM>&gt; +       } else if (year &gt;= 48 &amp;&amp; year &lt; 100) {
</EM><BR>
<EM>&gt;                 epoch = 1952;
</EM><BR>
<EM>&gt;                 guess = &quot;Digital UNIX&quot;;
</EM><BR>
<EM>&gt;         }
</EM><BR>
<EM>&gt; 
</EM><BR>
<P>This fix is just a crappy correction to the original code which was not
<BR>
only very ugly but also wrong with that abvious y2k bug.
<BR>
It would be much better to use different heuristics, as in clock(1) or
<BR>
hwclock(1). They check for a string in some initialisation structure to
<BR>
guess the console.
<BR>
<P>There was something different wrong with the rtc driver, which was the
<BR>
reason I stopped using it: The kernel blocked in BogoMIPS on warm boots.
<BR>
Don't know of that was fixed.
<BR>
- Alex
<BR>
<P>PS Sorry Ruediger, didn't want to send it to you directly
<BR>
<P><PRE>
-- 
To unsubscribe, e-mail: suse-axp-unsubscribe@suse.com
For additional commands, e-mail: suse-axp-help@suse.com
</PRE>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0116.html">SDenningho@aol.com: "[suse-axp] X on Alphastation 400  - Problem Fixed"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0114.html">Alex Rhomberg: "[suse-axp] gettimeofday resolution"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0113.html">Ruediger Oertel: "Re: [suse-axp] Re: RTC-Clock misfunction on AS 400"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0118.html">Ruediger Oertel: "Re: [suse-axp] Re: RTC-Clock misfunction on AS 400"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0113.html">Alex Rhomberg: "[suse-axp] Re: RTC-Clock misfunction on AS 400"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.www.fts.frontec.se/~dast/hypermail/">hypermail 2a22</A> 
: <EM>Sat Apr 01 2000 - 04:15:05 PST</EM>
</EM>
</SMALL>
</BODY>
</HTML>
