<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>Debian Alpha List: Install by NFS fails (while network works)</TITLE>
<META NAME="Author" CONTENT="Loic Prylli (Loic.Prylli@ens-lyon.fr)">
<META NAME="Subject" CONTENT="Install by NFS fails (while network works)">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Install by NFS fails (while network works)</H1>
<HR>
<P>
<!-- received="Fri Feb 05 00:26:59 1999 PST" -->
<!-- sent="Fri,  5 Feb 1999 01:24:42 +0100 (MET)" -->
<!-- name="Loic Prylli" -->
<!-- email="Loic.Prylli@ens-lyon.fr" -->
<!-- subject="Install by NFS fails (while network works)" -->
<!-- id="14010.8184.137261.360482@porto" -->
<!-- inreplyto="199901141213.NAA21892@ezili.sis.pasteur.fr" -->
<STRONG>Loic Prylli</STRONG> (<A HREF="mailto:Loic.Prylli@ens-lyon.fr?subject=Re:%20Install%20by%20NFS%20fails%20(while%20network%20works)"><EM>Loic.Prylli@ens-lyon.fr</EM></A>)<BR>
<EM>Fri,  5 Feb 1999 01:24:42 +0100 (MET)</EM>
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#92">[ date ]</A>
<A HREF="index.html#92">[ thread ]</A>
<A HREF="subject.html#92">[ subject ]</A>
<A HREF="author.html#92">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Previous message:</STRONG> <A HREF="0091.html">Christopher C Chimelis: "Weird..."</A>
<!-- nextthread="start" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Stephane Bortzmeyer writes:
<BR>
<EM> &gt; 
</EM><BR>
<EM> &gt; [No emergency, I finally installed from a CD and it worked.]
</EM><BR>
<EM> &gt; 
</EM><BR>
<EM> &gt; Trying to install the base system with NFS, I get:
</EM><BR>
<EM> &gt; 
</EM><BR>
<EM> &gt; mount RPC: timed out
</EM><BR>
<EM> &gt; 
</EM><BR>
<EM> &gt; when I try to mount the disk from the shell (the installation program just 
</EM><BR>
<EM> &gt; says there was an error).
</EM><BR>
<EM> &gt; 
</EM><BR>
<EM> &gt; What is odd is that the network works (I can ping) and the the mount 
</EM><BR>
<EM> &gt; apparently succeeded (here is what the NFS server says):
</EM><BR>
<P><P>Bonjour Stephane,
<BR>
<P>This  problem also occured to Oscar Levi recently, he suspected
<BR>
it was because the clocks of the nfs client and server was not
<BR>
synchronized.
<BR>
<P>Well trying to reproduce it, I tend to confirm this is related to a
<BR>
wrong wallclock setting, but in a very subtle way (both RPC and NFS
<BR>
normally make no assumption about clock synchronisation between client and
<BR>
server):
<BR>
Here is what I suspect:
<BR>
- due to current bad handling of Alpha CMOS, we sometimes end up in
<BR>
year 1930, or some other year before 1970 which is represented by a
<BR>
negative integer.  
<BR>
- RPC use the seconds returned by gettimeofday to construct an id
<BR>
- this id is generally stored in long variable, but goes through a ton 
<BR>
of htonl, ntohl, 32bit cast, 64 bit cast, to the peer and back (while
<BR>
on the network it is 32 bit), and at the end it is used to do the
<BR>
matching with the peer replies. It generally works well  
<BR>
because the id will generally be a positive value that fit into 31
<BR>
bit. But having a negative  time will cause a negative id to be
<BR>
generated, which cause undefined behaviour on the  upper 32 bit with
<BR>
ntohl (the behaviour is not the same when you compile with or without
<BR>
optimisation). So the final comparison should ignore the upper 32bit,
<BR>
which is not done currently.
<BR>
- this cause RPC based programs (and so mountd) to ignore any replies
<BR>
from a server, and then to timeout. 
<BR>
- I have tried to cast to 32 bit before doing the comparisons in
<BR>
glibc/sunrpc/pmap_rmt.c and glibc/sunrpc/clnt_tcp.c. I am currently
<BR>
recompiling the libc to see if it solves the problem.
<BR>
<P>Regards,
<BR>
<P><P>Loic
<BR>
<P><P><P>--  
<BR>
To UNSUBSCRIBE, email to <A HREF="mailto:debian-alpha-request@lists.debian.org?subject=Re:%20Install%20by%20NFS%20fails%20(while%20network%20works)">debian-alpha-request@lists.debian.org</A>
<BR>
with a subject of &quot;unsubscribe&quot;. Trouble? Contact <A HREF="mailto:listmaster@lists.debian.org?subject=Re:%20Install%20by%20NFS%20fails%20(while%20network%20works)">listmaster@lists.debian.org</A>
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Previous message:</STRONG> <A HREF="0091.html">Christopher C Chimelis: "Weird..."</A>
<!-- nextthread="start" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.landfield.com/hypermail/">hypermail 2.0b3</A> 
on <EM>Thu Feb 04 1999 - 17:00:24 PST</EM>
</EM>
</SMALL>
</BODY>
</HTML>
