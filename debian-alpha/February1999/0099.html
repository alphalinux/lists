<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>Debian Alpha List: Re: Install by NFS fails (while network work</TITLE>
<META NAME="Author" CONTENT="Oscar Levi (elf@buici.com)">
<META NAME="Subject" CONTENT="Re: Install by NFS fails (while network works)">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: Install by NFS fails (while network works)</H1>
<HR>
<P>
<!-- received="Fri Feb 05 03:35:27 1999 PST" -->
<!-- sent="Thu, 4 Feb 1999 19:32:16 -0800" -->
<!-- name="Oscar Levi" -->
<!-- email="elf@buici.com" -->
<!-- subject="Re: Install by NFS fails (while network works)" -->
<!-- id="19990204193214.B518@hazel.buici.com" -->
<!-- inreplyto="14010.8184.137261.360482@porto" -->
<STRONG>Oscar Levi</STRONG> (<A HREF="mailto:elf@buici.com?subject=Re:%20Install%20by%20NFS%20fails%20(while%20network%20works)"><EM>elf@buici.com</EM></A>)<BR>
<EM>Thu, 4 Feb 1999 19:32:16 -0800</EM>
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#99">[ date ]</A>
<A HREF="index.html#99">[ thread ]</A>
<A HREF="subject.html#99">[ subject ]</A>
<A HREF="author.html#99">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Previous message:</STRONG> <A HREF="0098.html">Oscar Levi: "Re: What patches to apply to build 2.0.35-alpha?"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0095.html">Christopher C Chimelis: "Re: What patches to apply to build 2.0.35-alpha?"</A>
<!-- nextthread="start" -->
</UL>
<HR>
<!-- body="start" -->
<P>
On Fri, Feb 05, 1999 at 01:24:42AM +0100, Loic Prylli wrote:
<BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Stephane Bortzmeyer writes:
</EM><BR>
<EM>&gt;  &gt; 
</EM><BR>
<EM>&gt;  &gt; [No emergency, I finally installed from a CD and it worked.]
</EM><BR>
<EM>&gt;  &gt; 
</EM><BR>
<EM>&gt;  &gt; Trying to install the base system with NFS, I get:
</EM><BR>
<EM>&gt;  &gt; 
</EM><BR>
<EM>&gt;  &gt; mount RPC: timed out
</EM><BR>
<EM>&gt;  &gt; 
</EM><BR>
<EM>&gt; &gt; when I try to mount the disk from the shell (the installation program just 
</EM><BR>
<EM>&gt;  &gt; says there was an error).
</EM><BR>
<EM>&gt;  &gt; 
</EM><BR>
<EM>&gt;  &gt; What is odd is that the network works (I can ping) and the the mount 
</EM><BR>
<EM>&gt;  &gt; apparently succeeded (here is what the NFS server says):
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Bonjour Stephane,
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; This  problem also occured to Oscar Levi recently, he suspected
</EM><BR>
<EM>&gt; it was because the clocks of the nfs client and server was not
</EM><BR>
<EM>&gt; synchronized.
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Well trying to reproduce it, I tend to confirm this is related to a
</EM><BR>
<EM>&gt; wrong wallclock setting, but in a very subtle way (both RPC and NFS
</EM><BR>
<EM>&gt; normally make no assumption about clock synchronisation between client and
</EM><BR>
<EM>&gt; server):
</EM><BR>
<EM>&gt; Here is what I suspect:
</EM><BR>
<EM>&gt; - due to current bad handling of Alpha CMOS, we sometimes end up in
</EM><BR>
<EM>&gt; year 1930, or some other year before 1970 which is represented by a
</EM><BR>
<EM>&gt; negative integer.  
</EM><BR>
<EM>&gt; - RPC use the seconds returned by gettimeofday to construct an id
</EM><BR>
<EM>&gt; - this id is generally stored in long variable, but goes through a ton 
</EM><BR>
<EM>&gt; of htonl, ntohl, 32bit cast, 64 bit cast, to the peer and back (while
</EM><BR>
<EM>&gt; on the network it is 32 bit), and at the end it is used to do the
</EM><BR>
<EM>&gt; matching with the peer replies. It generally works well  
</EM><BR>
<EM>&gt; because the id will generally be a positive value that fit into 31
</EM><BR>
<EM>&gt; bit. But having a negative  time will cause a negative id to be
</EM><BR>
<EM>&gt; generated, which cause undefined behaviour on the  upper 32 bit with
</EM><BR>
<EM>&gt; ntohl (the behaviour is not the same when you compile with or without
</EM><BR>
<EM>&gt; optimisation). So the final comparison should ignore the upper 32bit,
</EM><BR>
<EM>&gt; which is not done currently.
</EM><BR>
<EM>&gt; - this cause RPC based programs (and so mountd) to ignore any replies
</EM><BR>
<EM>&gt; from a server, and then to timeout. 
</EM><BR>
<EM>&gt; - I have tried to cast to 32 bit before doing the comparisons in
</EM><BR>
<EM>&gt; glibc/sunrpc/pmap_rmt.c and glibc/sunrpc/clnt_tcp.c. I am currently
</EM><BR>
<EM>&gt; recompiling the libc to see if it solves the problem.
</EM><BR>
<P>This is the kind of thing I, too, suspect.  I am rebuilding the kernel
<BR>
to verify that the correct time permits NFS mounts.  I believe that I
<BR>
was steered astray by someone on the kernel list who said that Linux
<BR>
said (are you getting the picture) that NFS was broken in 2.0.35.
<BR>
Now, I believe that the 2.0.35 NFS is fine and  that this time problem
<BR>
is what confounded me all along.
<BR>
<P>Builds take a LONG time on UDBs, so I suspect it will be days before
<BR>
we have conclusive answers.
<BR>
<P>Thanks for the sincere effors.
<BR>
<P><P>--  
<BR>
To UNSUBSCRIBE, email to <A HREF="mailto:debian-alpha-request@lists.debian.org?subject=Re:%20Install%20by%20NFS%20fails%20(while%20network%20works)">debian-alpha-request@lists.debian.org</A>
<BR>
with a subject of &quot;unsubscribe&quot;. Trouble? Contact <A HREF="mailto:listmaster@lists.debian.org?subject=Re:%20Install%20by%20NFS%20fails%20(while%20network%20works)">listmaster@lists.debian.org</A>
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Previous message:</STRONG> <A HREF="0098.html">Oscar Levi: "Re: What patches to apply to build 2.0.35-alpha?"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0095.html">Christopher C Chimelis: "Re: What patches to apply to build 2.0.35-alpha?"</A>
<!-- nextthread="start" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.landfield.com/hypermail/">hypermail 2.0b3</A> 
on <EM>Thu Feb 04 1999 - 20:00:24 PST</EM>
</EM>
</SMALL>
</BODY>
</HTML>
