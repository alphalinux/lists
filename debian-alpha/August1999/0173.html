<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>Debian Alpha List: Re: [Various] libc/1235: DB2 leaks mmaps (fw</TITLE>
<META NAME="Author" CONTENT="Jason Gunthorpe (jgg@ualberta.ca)">
<META NAME="Subject" CONTENT="Re: [Various] libc/1235: DB2 leaks mmaps (fwd)">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: [Various] libc/1235: DB2 leaks mmaps (fwd)</H1>
<HR>
<P>
<!-- received="Mon Aug 30 20:16:50 1999" -->
<!-- isoreceived="19990831031650" -->
<!-- sent="Mon, 30 Aug 1999 12:56:02 -0600 (MDT)" -->
<!-- isosent="19990830185602" -->
<!-- name="Jason Gunthorpe" -->
<!-- email="jgg@ualberta.ca" -->
<!-- subject="Re: [Various] libc/1235: DB2 leaks mmaps (fwd)" -->
<!-- id="Pine.LNX.3.96.990830125503.9605D-100000@Wakko.deltatee.com" -->
<!-- inreplyto="[Various] libc/1235: DB2 leaks mmaps (fwd)" -->
<STRONG>Subject: </STRONG>Re: [Various] libc/1235: DB2 leaks mmaps (fwd)<BR>
<STRONG>From: </STRONG>Jason Gunthorpe (<EM>jgg@ualberta.ca</EM>)<BR>
<STRONG>Date: </STRONG>Mon Aug 30 1999 - 11:56:02 PDT
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#173">[ date ]</A>
<A HREF="index.html#173">[ thread ]</A>
<A HREF="subject.html#173">[ subject ]</A>
<A HREF="author.html#173">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0174.html">Christopher C Chimelis: "Re: [Various] libc/1235: DB2 leaks mmaps (fwd)"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0172.html">David Frey: "Re: mispackaged packages.."</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0174.html">Christopher C Chimelis: "Re: [Various] libc/1235: DB2 leaks mmaps (fwd)"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Could I con someone into compiling libc on a fast alpha with this patch
<BR>
applied?
<BR>
<P>Thanks,
<BR>
Jason
<BR>
<P>---------- Forwarded message ----------
<BR>
Date: Mon, 30 Aug 1999 11:25:55 -0700 (PDT)
<BR>
From: &quot;H.J. Lu&quot; &lt;hjl@varesearch.com&gt;
<BR>
To: jgg@faure.debian.org
<BR>
Cc: jgg@ualberta.ca, GNU C Library &lt;libc-hacker@sourceware.cygnus.com&gt;
<BR>
Subject: Re: [Various] libc/1235: DB2 leaks mmaps
<BR>
<P>Could you please try this patch to see if it fixes your problem?
<BR>
<P>Thanks.
<BR>
<P><P><PRE>
-- 
H.J. Lu (hjl@gnu.org)
---
Mon Aug 30 11:19:56 1999  H.J. Lu  &lt;hjl@gnu.org&gt;
<P>	* db2/common/db_region.c (__db_rdetach): Unmap the region
	if necessary.
<P>Index: db2/common/db_region.c
===================================================================
RCS file: /work/cvs/gnu/glibc-2.1/db2/common/db_region.c,v
retrieving revision 1.1.1.6
diff -u -p -r1.1.1.6 db_region.c
--- db2/common/db_region.c	1998/09/11 13:48:08	1.1.1.6
+++ db2/common/db_region.c	1999/08/30 18:21:17
@@ -507,8 +507,18 @@ __db_rdetach(infop)
 	 * If the region was removed when it was created, no further action
 	 * is required.
 	 */
-	if (F_ISSET(infop, REGION_REMOVED))
+	if (F_ISSET(infop, REGION_REMOVED)) {
+		if (F_ISSET(infop, REGION_PRIVATE)
+		    &amp;&amp; !F_ISSET(infop, REGION_MALLOC))
+	 		/*
+			 * If it is private and not malloced, the
+			 * region is still mapped in. We need to
+			 * discard our mapping of the region.
+			 */
+			ret = __db_unmapregion(infop);
 		goto done;
+	}
+
 	/*
 	 * If the region was created in memory returned by malloc, the only
 	 * action required is freeing the memory.
<P><P>--  
To UNSUBSCRIBE, email to debian-alpha-request@lists.debian.org
with a subject of &quot;unsubscribe&quot;. Trouble? Contact listmaster@lists.debian.org
</PRE>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0174.html">Christopher C Chimelis: "Re: [Various] libc/1235: DB2 leaks mmaps (fwd)"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0172.html">David Frey: "Re: mispackaged packages.."</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0174.html">Christopher C Chimelis: "Re: [Various] libc/1235: DB2 leaks mmaps (fwd)"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.www.fts.frontec.se/~dast/hypermail/">hypermail 2a22</A> 
: <EM>Tue Sep 07 1999 - 16:15:08 PDT</EM>
</EM>
</SMALL>
</BODY>
</HTML>
