<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>Debian Alpha List: Re: Correct way to build .deb with -mieee</TITLE>
<META NAME="Author" CONTENT="Adam C Powell IV (hazelsct@mit.edu)">
<META NAME="Subject" CONTENT="Re: Correct way to build .deb with -mieee">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: Correct way to build .deb with -mieee</H1>
<HR>
<P>
<!-- received="Thu Jul 05 16:14:35 2001" -->
<!-- isoreceived="20010705231435" -->
<!-- sent="Thu, 05 Jul 2001 11:47:49 -0400" -->
<!-- isosent="20010705154749" -->
<!-- name="Adam C Powell IV" -->
<!-- email="hazelsct@mit.edu" -->
<!-- subject="Re: Correct way to build .deb with -mieee" -->
<!-- id="3B448C25.1080806@mit.edu" -->
<!-- inreplyto="Pine.LNX.4.21.0106191605290.16838-100000@spawn.hockeyfiend.com" -->
<STRONG>Subject: </STRONG>Re: Correct way to build .deb with -mieee<BR>
<STRONG>From: </STRONG>Adam C Powell IV (<EM>hazelsct@mit.edu</EM>)<BR>
<STRONG>Date: </STRONG>Thu Jul 05 2001 - 08:47:49 PDT
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#1">[ date ]</A>
<A HREF="index.html#1">[ thread ]</A>
<A HREF="subject.html#1">[ subject ]</A>
<A HREF="author.html#1">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0002.html">mel kravitz: "netscape?"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0000.html">Christopher C. Chimelis: "Re: glitch with e2fsprogs, alpha, e2writeboot"</A>
<!-- nextthread="start" -->
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Christopher C. Chimelis wrote:
<BR>
<P><EM>&gt;On Tue, 19 Jun 2001, Adam C Powell IV wrote:
</EM><BR>
<EM>&gt;
</EM><BR>
<EM>&gt;&gt;I have a program (petscgraphics) which, when built without -mieee, fails 
</EM><BR>
<EM>&gt;&gt;with SIGFPE (division by zero); with -mieee, works perfectly (still 
</EM><BR>
<EM>&gt;&gt;divides by zero, but works anyway).
</EM><BR>
<EM>&gt;&gt;
</EM><BR>
<EM>&gt;&gt;So, should -mieee go in debian/rules, something like &quot;CFLAGS=-mieee 
</EM><BR>
<EM>&gt;&gt;./configure --prefix=/usr&quot;?  Or is there a more intelligent way for 
</EM><BR>
<EM>&gt;&gt;upstream (me) to put it in, such that it is only used for one source 
</EM><BR>
<EM>&gt;&gt;file (petscgraphics.c)?
</EM><BR>
<EM>&gt;&gt;
</EM><BR>
<EM>&gt;
</EM><BR>
<EM>&gt;It's usually ideal to make such changes in the autoconf scripts, unless
</EM><BR>
<EM>&gt;the software doesn't use autoconf.  If it doesn't, then the best way may
</EM><BR>
<EM>&gt;be to handle it via debian/rules.  Since it's only needed for one file,
</EM><BR>
<EM>&gt;though, doing a &quot;blanket&quot; -mieee compilation would probably be overkill...
</EM><BR>
<EM>&gt;
</EM><BR>
Indeed.  I took this approach (autoconf scripts), and now PETScGraphics 
<BR>
works on alpha.
<BR>
<P>Just &quot;for the record&quot;, here's what I did: in configure.in
<BR>
<P>AC_CHECKING([whether -mieee is needed to avoid SIGFPE on divide by zero])
<BR>
case $build/$CC in
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;alpha*/gcc* )
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;build_gcc_alpha=yes
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;AC_MSG_RESULT([yes, will be used for libpetscgraphics])
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;;;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;* )
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;build_gcc_alpha=no
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;AC_MSG_RESULT([not needed])
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;;;
<BR>
esac
<BR>
AM_CONDITIONAL(GCC_ALPHA, test x$build_gcc_alpha != xno)
<BR>
<P>Then in Makefile.am, I copied the %.lo:%.c target from Makefile.in but 
<BR>
added -mieee for this particular file:
<BR>
<P># This is to get -mieee in for gcc on Alpha
<BR>
if GCC_ALPHA
<BR>
petscgraphics.lo: petscgraphics.c
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;@echo '$(LTCOMPILE) -mieee -c $&lt;'; \
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;$(LTCOMPILE) -mieee -Wp,-MD,.deps/$(*F).pp -c $&lt;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;@-sed -e 's/^\([^:]*\)\.o[     ]*:/\1.lo \1.o :/' \
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt; .deps/$(*F).pp &gt; .deps/$(*F).P; \
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;tr ' ' '\012' &lt; .deps/$(*F).pp \
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| sed -e 's/^\\$$//' -e '/^$$/ d' -e '/:$$/ d' -e 's/$$/ :/' \
<BR>
<EM>        &gt;&gt; .deps/$(*F).P; \
</EM><BR>
&nbsp;&nbsp;&nbsp;&nbsp;rm -f .deps/$(*F).pp
<BR>
endif # GCC_ALPHA
<BR>
<P>I really don't know what all the obscure sed and tr stuff does (except 
<BR>
that it helps set up build dependencies properly), and it may break on 
<BR>
automake upgrade, but at least for now it works. :-)
<BR>
<P>HTH, share and enjoy, etc.
<BR>
<PRE>
-- 
<P>-Adam P.
<P>GPG fingerprint: D54D 1AEE B11C CE9B A02B  C5DD 526F 01E8 564E E4B6
<P>Welcome to the best software in the world today cafe! 
&lt;<A HREF="http://lyre.mit.edu/%7Epowell/The_Best_Stuff_In_The_World_Today_Cafe.ogg">http://lyre.mit.edu/%7Epowell/The_Best_Stuff_In_The_World_Today_Cafe.ogg</A>&gt;
<P><P><P><P>-- 
To UNSUBSCRIBE, email to debian-alpha-request@lists.debian.org
with a subject of &quot;unsubscribe&quot;. Trouble? Contact listmaster@lists.debian.org
</PRE>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0002.html">mel kravitz: "netscape?"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0000.html">Christopher C. Chimelis: "Re: glitch with e2fsprogs, alpha, e2writeboot"</A>
<!-- nextthread="start" -->
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.www.fts.frontec.se/~dast/hypermail/">hypermail 2a22</A> 
: <EM>Wed Aug 01 2001 - 06:11:43 PDT</EM>
</EM>
</SMALL>
</BODY>
</HTML>
