<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>Debian Alpha List: bsddisklabel and BLKRRPART</TITLE>
<META NAME="Author" CONTENT="Andrea Arcangeli (andrea@suse.de)">
<META NAME="Subject" CONTENT="bsddisklabel and BLKRRPART">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>bsddisklabel and BLKRRPART</H1>
<HR>
<P>
<!-- received="Wed Oct 13 00:53:13 1999" -->
<!-- isoreceived="19991013075313" -->
<!-- sent="Wed, 13 Oct 1999 01:17:39 +0200 (CEST)" -->
<!-- isosent="19991012231739" -->
<!-- name="Andrea Arcangeli" -->
<!-- email="andrea@suse.de" -->
<!-- subject="bsddisklabel and BLKRRPART" -->
<!-- id="Pine.LNX.4.10.9910130103120.832-100000@alpha.random" -->
<!-- inreplyto="Pine.LNX.4.10.9910122317280.18982-100000@alpha.random" -->
<STRONG>Subject: </STRONG>bsddisklabel and BLKRRPART<BR>
<STRONG>From: </STRONG>Andrea Arcangeli (<EM>andrea@suse.de</EM>)<BR>
<STRONG>Date: </STRONG>Tue Oct 12 1999 - 16:17:39 PDT
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#74">[ date ]</A>
<A HREF="index.html#74">[ thread ]</A>
<A HREF="subject.html#74">[ subject ]</A>
<A HREF="author.html#74">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0075.html">Andries.Brouwer@cwi.nl: "Re: bsddisklabel and BLKRRPART"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0073.html">Ron Farrer: "Re: gnome dependancies and X still broken"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0068.html">Andrea Arcangeli: "Re: 2.2.x corruption solved (Was Re: Statically linked 'tar')"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0075.html">Andries.Brouwer@cwi.nl: "Re: bsddisklabel and BLKRRPART"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0068.html">Andrea Arcangeli: "bsddisklabel and BLKRRPART"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
On Tue, 12 Oct 1999, Andrea Arcangeli wrote:
<BR>
<P><EM>&gt;&gt;Second, it is a well known problem that either fdisk or the kernel (I think
</EM><BR>
<EM>&gt;&gt;it's just a missed out call to ioctl() in fdisk) will not re-scan the
</EM><BR>
<EM>&gt;
</EM><BR>
<EM>&gt;Reproduced here. I think it's the missing ioctl in fdisk after writing
</EM><BR>
<EM>&gt;partitions to disk.
</EM><BR>
<P>Here it is the fix (works fine here). Please merge it in the next
<BR>
ulil-linux relases.
<BR>
<P>--- util-linux-2.9t/fdisk/fdiskbsdlabel.c.~1~	Sat May  1 13:31:05 1999
<BR>
+++ util-linux-2.9t/fdisk/fdiskbsdlabel.c	Wed Oct 13 00:42:50 1999
<BR>
@@ -52,6 +52,7 @@
<BR>
&nbsp;#include &lt;sys/param.h&gt;
<BR>
&nbsp;
<BR>
&nbsp;#include &lt;linux/hdreg.h&gt;	/* for HDIO_GETGEO */
<BR>
+#include &lt;sys/mount.h&gt;		/* BLKRRPART */
<BR>
&nbsp;
<BR>
&nbsp;#include &quot;common.h&quot;
<BR>
&nbsp;#include &quot;fdisk.h&quot;
<BR>
@@ -769,6 +770,9 @@
<BR>
&nbsp;&nbsp;&nbsp;printf (_(&quot;\nSyncing disks.\n&quot;));
<BR>
&nbsp;&nbsp;&nbsp;sync ();
<BR>
&nbsp;&nbsp;&nbsp;sleep (4);
<BR>
+  printf(_(&quot;Calling ioctl() to re-read partition table.\n&quot;));
<BR>
+  if (ioctl(fd, BLKRRPART) &lt; 0)
<BR>
+	  perror(&quot;failed to reload the partiton table&quot;);
<BR>
&nbsp;}
<BR>
&nbsp;
<BR>
&nbsp;#if defined (i386) || defined (sparc)
<BR>
<P>Andrea
<BR>
<P><P>--  
<BR>
To UNSUBSCRIBE, email to debian-alpha-request@lists.debian.org
<BR>
with a subject of &quot;unsubscribe&quot;. Trouble? Contact listmaster@lists.debian.org
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0075.html">Andries.Brouwer@cwi.nl: "Re: bsddisklabel and BLKRRPART"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0073.html">Ron Farrer: "Re: gnome dependancies and X still broken"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0068.html">Andrea Arcangeli: "Re: 2.2.x corruption solved (Was Re: Statically linked 'tar')"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0075.html">Andries.Brouwer@cwi.nl: "Re: bsddisklabel and BLKRRPART"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0068.html">Andrea Arcangeli: "bsddisklabel and BLKRRPART"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.www.fts.frontec.se/~dast/hypermail/">hypermail 2a22</A> 
: <EM>Thu Nov 04 1999 - 16:56:58 PST</EM>
</EM>
</SMALL>
</BODY>
</HTML>
