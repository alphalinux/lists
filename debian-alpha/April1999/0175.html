<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>Debian Alpha List: xntpd does not seem to adjust the clock</TITLE>
<META NAME="Author" CONTENT="Loic Prylli (Loic.Prylli@ens-lyon.fr)">
<META NAME="Subject" CONTENT="xntpd does not seem to adjust the clock">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>xntpd does not seem to adjust the clock</H1>
<HR>
<P>
<!-- received="Sat Apr 24 23:34:39 1999 PDT" -->
<!-- sent="Sat, 24 Apr 1999 22:41:06 +0200 (MET DST)" -->
<!-- name="Loic Prylli" -->
<!-- email="Loic.Prylli@ens-lyon.fr" -->
<!-- subject="xntpd does not seem to adjust the clock" -->
<!-- id="14114.10249.833991.771461@porto" -->
<!-- inreplyto="199904140705.QAA20856@bosei.cc.u-tokai.ac.jp" -->
<STRONG>Loic Prylli</STRONG> (<A HREF="mailto:Loic.Prylli@ens-lyon.fr?subject=Re:%20xntpd%20does%20not%20seem%20to%20adjust%20the%20clock"><EM>Loic.Prylli@ens-lyon.fr</EM></A>)<BR>
<EM>Sat, 24 Apr 1999 22:41:06 +0200 (MET DST)</EM>
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#175">[ date ]</A>
<A HREF="index.html#175">[ thread ]</A>
<A HREF="subject.html#175">[ subject ]</A>
<A HREF="author.html#175">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Previous message:</STRONG> <A HREF="0174.html">Loic Prylli: "Re: Potato woes"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0168.html">Brederlow: "Re: Potato woes"</A>
<!-- nextthread="start" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Naohiko Shimizu writes:
<BR>
<EM> &gt; Hi,
</EM><BR>
<EM> &gt; 
</EM><BR>
<EM> &gt; I use slink. And I have a ntp server in my room 
</EM><BR>
<EM> &gt; which is syncronize to an external ntp server. 
</EM><BR>
<EM> &gt; I installed the xntpd3 package, but it does not seem to adjust the clock.
</EM><BR>
<EM> &gt; (Of course I worte the /etc/ntp.conf file.)
</EM><BR>
<EM> &gt; The clock runs evidently slow than the server (about 30 minutes a day).
</EM><BR>
<EM> &gt; On the other hand, I have x86 machine which also runs slink. 
</EM><BR>
<EM> &gt; It seem to work fine.
</EM><BR>
<EM> &gt; 
</EM><BR>
<EM> &gt; Does anyone have same problem or any solution?
</EM><BR>
<EM> &gt; 
</EM><BR>
<P>Hello,
<BR>
<P>Which kernel are you using?
<BR>
I just try to investigate and it looks that under 2.2.x you need to
<BR>
apply something like the kernel patch below to have NTP working.
<BR>
<P>If you are actually running a 2.0.x kernel, a copy of
<BR>
ntpstats/{loopstats,peerstats}, and the output of &quot;adjtimex --print&quot;
<BR>
could help to find the problem.
<BR>
<P>Regards,
<BR>
<P>Loic
<BR>
<P>--- linux22/arch/alpha/kernel/osf_sys.c   1999/04/13 12:36:12     1.1.1.1
<BR>
+++ linux22/arch/alpha/kernel/osf_sys.c   1999/04/24 19:01:05
<BR>
@@ -1408,7 +1408,7 @@
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offsetof(struct timex32, time)))
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -EFAULT;
<BR>
&nbsp;
<BR>
-       if ((ret = do_adjtimex(&amp;txc)))
<BR>
+       if ((ret = do_adjtimex(&amp;txc)) &lt; 0)
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ret;
<BR>
&nbsp;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* copy back to timex32 */
<BR>
@@ -1418,5 +1418,5 @@
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(put_tv32(&amp;txc_p-&gt;time, &amp;txc.time)))
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -EFAULT;
<BR>
&nbsp;
<BR>
-       return 0;
<BR>
+       return ret;
<BR>
&nbsp;}
<BR>
<P><P>--  
<BR>
To UNSUBSCRIBE, email to <A HREF="mailto:debian-alpha-request@lists.debian.org?subject=Re:%20xntpd%20does%20not%20seem%20to%20adjust%20the%20clock">debian-alpha-request@lists.debian.org</A>
<BR>
with a subject of &quot;unsubscribe&quot;. Trouble? Contact <A HREF="mailto:listmaster@lists.debian.org?subject=Re:%20xntpd%20does%20not%20seem%20to%20adjust%20the%20clock">listmaster@lists.debian.org</A>
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Previous message:</STRONG> <A HREF="0174.html">Loic Prylli: "Re: Potato woes"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0168.html">Brederlow: "Re: Potato woes"</A>
<!-- nextthread="start" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.landfield.com/hypermail/">hypermail 2.0b3</A> 
on <EM>Sat Apr 24 1999 - 17:00:11 PDT</EM>
</EM>
</SMALL>
</BODY>
</HTML>
