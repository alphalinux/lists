<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>High Performance Alpha Linux: Re: request for perf improvement</TITLE>
<META NAME="Author" CONTENT="Adam C. Powell, IV (adam.powell@nist.gov)">
<META NAME="Subject" CONTENT="Re: request for perf improvement suggestions">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: request for perf improvement suggestions</H1>
<HR>
<P>
<!-- received="Wed Nov 25 06:26:24 1998 EST" -->
<!-- sent="Wed, 25 Nov 1998 16:44:07 -0500" -->
<!-- name="Adam C. Powell, IV" -->
<!-- email="adam.powell@nist.gov" -->
<!-- subject="Re: request for perf improvement suggestions" -->
<!-- id="365C7A27.90C83909@nist.gov" -->
<!-- inreplyto="Pine.LNX.3.96.981125155452.6224A-100000@bec.physics.udel.edu" -->
<STRONG>Adam C. Powell, IV</STRONG> (<A HREF="mailto:adam.powell@nist.gov?subject=Re:%20request%20for%20perf%20improvement%20suggestions"><EM>adam.powell@nist.gov</EM></A>)<BR>
<EM>Wed, 25 Nov 1998 16:44:07 -0500</EM>
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#4">[ date ]</A>
<A HREF="index.html#4">[ thread ]</A>
<A HREF="subject.html#4">[ subject ]</A>
<A HREF="author.html#4">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Previous message:</STRONG> <A HREF="0003.html">Jonathan L Dubois: "request for perf improvement suggestions"</A>
<!-- nextthread="start" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Jonathan L Dubois wrote:
<BR>
<P><EM>&gt; Hello everyone,
</EM><BR>
<EM>&gt;
</EM><BR>
<EM>&gt; I have some code I would like to optomize and I could use some suggestions
</EM><BR>
<EM>&gt; and pointers for where to get started.
</EM><BR>
<EM>&gt;
</EM><BR>
<EM>&gt; The function which is called most often and the most likely candidate
</EM><BR>
<EM>&gt; for improvement (I think) calculates the distance between two vectors.
</EM><BR>
<P>Under some conditions you can go a long way by using K. Goto's optimized BLAS
<BR>
routines (gemm, copy, dot, axpy).  If you have two separate sets of n vectors
<BR>
and want to calculate the n distances between corresponding vectors of each
<BR>
set, you can store them as two arrays of coordinates, copy the first array,
<BR>
use axpy to subtract the second array, and then use dot for each vector (dot
<BR>
itself) to get the sum of squares.  You might get some speedup too by saving
<BR>
all of the square roots for last, and then doing them all at once, so
<BR>
whatever tables are used by sqrt sit in cache the whole time.
<BR>
<P>On the other hand, if you have a collection of n vectors and want to get all
<BR>
n(n+1)/2 distances between them, you'll have to be more creative.  For
<BR>
example, to get all of the distances from the first vector to the others
<BR>
(assuming they're all stored as one big array of coordinates), you could
<BR>
create an array of n-1 ones, use gemm to &quot;multiply&quot; the 3x1 vector by this
<BR>
1x(n-1) array of ones to give a 3x(n-1) matrix with each column being the
<BR>
first vector, then use axpy to subtract all of the other vectors from this,
<BR>
and dot each column with itself to get sums of squares.  Now repeat for the
<BR>
second vector, and all the others.  Finally, square root everything.
<BR>
<P>On the other hand, if you have n vectors and want some arbitrary subset of
<BR>
the n(n+1)/2 distanes, well, this may not help much.
<BR>
<P>This approach would vectorize the subtractions very nicely, but the dot
<BR>
products might be slowed down by the overhead of the function calls to ddot_
<BR>
as much as they are sped up by the assembly acceleration- maybe there's a way
<BR>
to use another BLAS function call to do this...  (If gemm could be convinced
<BR>
to only calculate the diagonals of the product, you could multiply the
<BR>
transpose of the difference matrix by its non-transpose to give a vector of
<BR>
the dot products; but gemm doesn't do this.)  Oh- you'll also have to
<BR>
substantially change the program architecture.  (Fun! :-)
<BR>
<P>Hope this helps (and isn't too obscure).
<BR>
<P>Zeen,
<BR>
<P>-Adam `Cold Fusion' Powell, IV <A HREF="http://www.ctcms.nist.gov/~powell/">http://www.ctcms.nist.gov/~powell/</A> ____
<BR>
USDoC, National Institute of Standards &amp; Technology (NIST)  |\ ||&lt;  |
<BR>
Center for Theoretical and Computational Materials Science  | \||_&gt; |
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Previous message:</STRONG> <A HREF="0003.html">Jonathan L Dubois: "request for perf improvement suggestions"</A>
<!-- nextthread="start" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.landfield.com/hypermail/">hypermail 2.0b3</A> 
on <EM>Wed Nov 25 1998 - 06:26:29 EST</EM>
</EM>
</SMALL>
</BODY>
</HTML>
