<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN"> 
     <HTML> 
     <HEAD> 
     <TITLE>Axp-List Archive</TITLE> 
     <LINK REV="made" HREF="mailto:mailto-address"> 
     <HEAD> 
     <BODY BGCOLOR="#DC9D33" TEXT="#000000" LINK="#DD0000" ALINK="#CC0000" VLINK="#CC0000">
		<CENTER>  <!--#exec cgi="/cgi-bin/banmat1.cgi"--></CENTER>

     <H1 ALIGN=CENTER>Axp-List Archive<BR> Re: /proc/&lt;pid&gt;/maps</H1> 
	
<!-- received="Sat Mar 18 01:26:29 2000" -->
<!-- isoreceived="20000318092629" -->
<!-- sent="Fri, 17 Mar 2000 17:08:51 -0800" -->
<!-- isosent="20000318010851" -->
<!-- name="Richard Henderson" -->
<!-- email="rth@twiddle.net" -->
<!-- subject="Re: /proc/&lt;pid&gt;/maps" -->
<!-- id="20000317170851.A4725@twiddle.net" -->
<!-- inreplyto="412568A5.00832BF4.00@saturn.aladdin.de" -->
<STRONG>Subject: </STRONG>Re: /proc/<pid>/maps<BR>
<STRONG>From: </STRONG>Richard Henderson (<EM>rth@twiddle.net</EM>)<BR>
<STRONG>Date: </STRONG>Fri Mar 17 17:08:51 2000
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.shtml#434">[ date ]</A>
<A HREF="index.shtml#434">[ thread ]</A>
<A HREF="subject.shtml#434">[ subject ]</A>
<A HREF="author.shtml#434">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0435.shtml">B. James Phillippe: "Re: Anyone try XF86-4.0 yet?"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0433.shtml">Chris Kloiber: "Re: Anyone try XF86-4.0 yet?"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0432.shtml">cpg@aladdin.de: "/proc/&lt;pid&gt;/maps"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0437.shtml">cpg@aladdin.de: "Re: /proc/&lt;pid&gt;/maps"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0432.shtml">Richard Henderson: "Re: /proc/&lt;pid&gt;/maps"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
On Sat, Mar 18, 2000 at 12:48:21AM +0100, cpg@aladdin.de wrote:
<BR>
<EM>&gt; If I look at /proc/&lt;pid&gt;/maps I've got 3 entries for every shared lib
</EM><BR>
<EM>&gt; the process uses. On i386 there are only 2 entries for each shlib
</EM><BR>
[...]
<BR>
<EM>&gt; What is the purpose of this mapping and where does it come from?
</EM><BR>
<P>This is an artifact of the glibc ld.so.  It will appear on any
<BR>
architecture that has a maximum architectural page size larger
<BR>
than the current os page size.
<BR>
<P>What happens is that glibc reserves the entire memory region
<BR>
that it needs with PROT_NONE.  We do this because all segments
<BR>
must have a fixed relationship with one another, so we have
<BR>
mmap bring us the first unused contiguous region that's large
<BR>
enough.
<BR>
<P>We then goes back and remap the actual Phdr entries with proper
<BR>
permissions and MAP_FIXED.  If, for the reason mentioned above,
<BR>
the linker has &quot;overaligned&quot; the data segment, then there may be
<BR>
unused space between the text and data segment.
<BR>
<P>We could of course unmap that region, but there's not really
<BR>
any point.  On no system that I am aware of will it be larger
<BR>
than 16 pages, which means that the PMD is already in use,
<BR>
which means that we're not really consuming any extra page
<BR>
table resources.
<BR>
<P>The lack of foresight in not defining a large maximum architectural
<BR>
page size for x86 is actually hurting ia64 folks who want to do
<BR>
emulation.  Ideally they'd like to have a 16K system page size,
<BR>
but all the x86 binaries are linked expecting a 4K page size.
<BR>
Which can be worked around with effort, but it shouldn't have
<BR>
been necessary.
<BR>
<P><P>r~
<BR>
<P><PRE>
-- 
To unsubscribe: send e-mail to axp-list-request@redhat.com with
'unsubscribe' as the subject.  Do not send it to axp-list@redhat.com
</PRE>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0435.shtml">B. James Phillippe: "Re: Anyone try XF86-4.0 yet?"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0433.shtml">Chris Kloiber: "Re: Anyone try XF86-4.0 yet?"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0432.shtml">cpg@aladdin.de: "/proc/&lt;pid&gt;/maps"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0437.shtml">cpg@aladdin.de: "Re: /proc/&lt;pid&gt;/maps"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0432.shtml">Richard Henderson: "Re: /proc/&lt;pid&gt;/maps"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR> 
     <P> 
     <SMALL> 
     <EM> 
     This archive was generated by  <A HREF="http://www.landfield.com/hypermail">hypermail version 2a22 </A> on Sat Apr  1 04:15:01 2000 PST <BR>
	Send any problems or questions about this archive to <A HREF="mailto:webmaster@alphalinux.org">webmaster@alphalinux.org</A>. 
     </EM> 
     </SMALL> 
     </BODY> 
     </HTML> 
