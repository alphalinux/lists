<!-- received="Mon Mar  4 14:13:14 1996 " -->
<!-- sent="Mon, 4 Mar 1996 14:13:14 -0700" -->
<!-- name="David Mosberger-Tang" -->
<!-- email="davidm@AZStarNet.com" -->
<!-- subject="Re: axp-diff-1.3.70" -->
<!-- id="199603042113.OAA29832@koala.azstarnet.com" -->
<!-- inreplyto="axp-diff-1.3.70" -->
<HTML><HEAD><META NAME="htdig-email" CONTENT="webmaster@redhat.com"><TITLE>Re: axp-diff-1.3.70</TITLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#ececec"  LINK="#3333cc" VLINK="#666666"><h2>Re: axp-diff-1.3.70</h2>

<b>David Mosberger-Tang</b> (<a href="mailto:davidm@AZStarNet.com"><i>davidm@AZStarNet.com</i></a>)<br>
<i>Mon, 4 Mar 1996 14:13:14 -0700</i>
<p>
<ul>
<li> <b>Messages sorted by:</b> <a href="date.html#32">[ date ]</a><a href="index.html#32">[ thread ]</a><a href="subject.html#32">[ subject ]</a><a href="author.html#32">[ author ]</a>
<!-- next="start" -->
<li> <b>Next message:</b> <a href="0033.html">David Mosberger-Tang: "Re: time(1) incorrect (Re) ... times(3) strange; clock_t == long"</a>
<li> <b>Previous message:</b> <a href="0031.html">David Mosberger-Tang: "Re: 3c509 on a Noname"</a>
<li> <b>Maybe in reply to:</b> <a href="0013.html">David Mosberger-Tang: "axp-diff-1.3.70"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<!-- body="start" -->
<i>&gt;&gt;&gt;&gt;&gt; On Sun, 3 Mar 1996 20:59:39 +1100 (AES), Matthew Geier &lt;<a href="mailto:matthew@sleeper.apana.org.au">matthew@sleeper.apana.org.au</a>&gt; said:</i><br>
<p>
  Matthew&gt;  Could this be related to my Noname system clock running<br>
  Matthew&gt; slow ?. It would appear the system is missing<br>
  Matthew&gt; interupts. Lots of them.  I sync the clock twice a day with<br>
  Matthew&gt; netdate. Its not uncommon for 3000 second<br>
  Matthew&gt; corrections. Other times its just a few seconds..<br>
<p>
OK, I can reproduce this when using an IDE drive.  It looks like the<br>
IDE driver keeps interrupts disabled for long periods of time.  If I<br>
compile a kernel, it looses about 0.06 seconds/second (or about 61<br>
interrupts per second).  If the system is idle (save for occasional<br>
background activity), it looses only about 0.001 seconds/second.<br>
<p>
The quick &amp; dirty fix: do<br>
<p>
	hdparm -u 1 /dev/hd?<br>
<p>
for each of the IDE drives in your system.  This will configure the<br>
IDE driver to reenable interrupts as quickly as possible.  This option<br>
is labeled "dangerous", but I was able to do a kernel compile without<br>
any ill effects and from reading the sources, it looks like it should<br>
be save except for old/broken IDE interfaces (and those probably<br>
became extinct even before the Alpha era...).<br>
<p>
The real fix is to either disallow drivers to disable clock interrupts<br>
(a solution Linus doesn't like, AFAIK) or to use the Alpha's cycle<br>
counter to detect lost interrupts.  The important thing in the latter<br>
solution is that it's not OK to use the cycle counter *instead* of the<br>
timer interrupt since the timer interrupt is derived from the<br>
real-time clock, which presumably has much better long-term stability<br>
than the crystal generating the CPU clock.<br>
<p>
Feedback welcome.<br>
<p>
	--david<br>
<!-- body="end" -->
<p>
<ul>
<!-- next="start" -->
<li> <b>Next message:</b> <a href="0033.html">David Mosberger-Tang: "Re: time(1) incorrect (Re) ... times(3) strange; clock_t == long"</a>
<li> <b>Previous message:</b> <a href="0031.html">David Mosberger-Tang: "Re: 3c509 on a Noname"</a>
<li> <b>Maybe in reply to:</b> <a href="0013.html">David Mosberger-Tang: "axp-diff-1.3.70"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<br clear=all>
<hr>
<center>
<a href="mailto:webmaster@redhat.com"   target="">Feedback</a> | 
<a href="http://www.redhat.com/products/"   target="">Store</a> | 
<a href="http://www.redhat.com/news/"   target="">News</a> | 
<a href="http://www.redhat.com/support/"   target="">Support</a> | 
<a href="http://www.redhat.com/support/docs/errata.html"   target="">Product Errata</a> | 
<a href="http://www.redhat.com/redhat/"   target="">About Us</a> | 
<a href="http://www.redhat.com/linux-info/"   target="">Linux Info</a> | 
<a href="http://www.redhat.com/search/"   target="">Search</a> | 
<a href="http://www.redhat.com/jumplist.phtml"   target="">JumpWords</a>
<br>
<a href="http://www.redhat.com/cgi-bin/frames.phtml?fr=n"  _top target="_top">No Frames</a> | 
<a href="http://www.redhat.com/cgi-bin/frames.phtml?fr=y"  _top target="_top">Show Frames</a>
</center>
<p align=center>
Copyright &copy; 1995-1997 Red Hat Software. <a href="http://www.redhat.com/redhat/website.html#legal"   target="">Legal notices</a>
</p>
</BODY></HTML>
