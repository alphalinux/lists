<!-- received="Fri Jun  7 17:32:09 1996 " -->
<!-- sent="Fri, 7 Jun 1996 17:32:09 +0200" -->
<!-- name="Wolfram Gloger" -->
<!-- email="Wolfram.Gloger@Dent.MED.Uni-Muenchen.DE" -->
<!-- subject="Doug Lea's malloc adapted for 64bit, needs testing" -->
<!-- id="199606071532.RAA12367@md.dent.med.uni-muenchen.de" -->
<!-- inreplyto="" -->
<HTML><HEAD><META NAME="htdig-email" CONTENT="webmaster@redhat.com"><TITLE>Doug Lea's malloc adapted for 64bit, needs testing</TITLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#ececec"  LINK="#3333cc" VLINK="#666666"><h2>Doug Lea's malloc adapted for 64bit, needs testing</h2>

<b>Wolfram Gloger</b> (<a href="mailto:Wolfram.Gloger@Dent.MED.Uni-Muenchen.DE"><i>Wolfram.Gloger@Dent.MED.Uni-Muenchen.DE</i></a>)<br>
<i>Fri, 7 Jun 1996 17:32:09 +0200</i>
<p>
<ul>
<li> <b>Messages sorted by:</b> <a href="date.html#100">[ date ]</a><a href="index.html#100">[ thread ]</a><a href="subject.html#100">[ subject ]</a><a href="author.html#100">[ author ]</a>
<!-- next="start" -->
<li> <b>Next message:</b> <a href="0101.html">David Mosberger-Tang: "Re: Doug Lea's malloc adapted for 64bit, needs testing"</a>
<li> <b>Previous message:</b> <a href="0099.html">Craig Burley: "Re: GNU"</a>
<!-- nextthread="start" -->
<li> <b>Next in thread:</b> <a href="0101.html">David Mosberger-Tang: "Re: Doug Lea's malloc adapted for 64bit, needs testing"</a>
<li> <b>Maybe reply:</b> <a href="0101.html">David Mosberger-Tang: "Re: Doug Lea's malloc adapted for 64bit, needs testing"</a>
<!-- reply="end" -->
</ul>
<!-- body="start" -->
Hi,<br>
<p>
Over the last days, I have hacked Doug Lea's latest malloc version<br>
so that it runs on 64bit-architectures (or so I hope). Unfortunately,<br>
I don't have access to a 64bit machine yet, so I hope someone else<br>
can test it or, if there should be problems, let me test it on a<br>
temporary account.<br>
<p>
Why do this ?  I don't know which malloc version you're using in<br>
alpha-libc, but if it's GNU malloc or (worse) derived from the old BSD<br>
code, there is a lot to gain from using Doug's version.  It is by far<br>
the most space-efficient malloc implementation that I know of.  It<br>
excels in particular at dealing with widely varying allocation size<br>
distributions, showing little fragmentation and returning memory to<br>
the system via sbrk(-x) or munmap().  On the latest Linux kernels, it<br>
also supports fast realloc()ation of large chunks via the mremap()<br>
system call.  I would like to have dl-malloc put into GNU libc, but a<br>
prerequisite is that it runs on 64bit architectures.<br>
<p>
I hope it does so now.  There is a catch though, because with<br>
sizeof(void*)=8 and sizeof(size_t)=4 the minimum chunk size is 24bytes<br>
(compared to 16bytes on a 32bit arch), so the worst-case overhead<br>
becomes 20bytes rather than 12 (the normal overhead for larger chunks<br>
remains only 4bytes).  But if you're allocating lots and lots of 4byte<br>
(or smaller) chunks, you should probably be running your own<br>
special-purpose allocator anyway.<br>
<p>
You can get the malloc source file from<br>
<p>
  <a href="ftp://md.dent.med.uni-muenchen.de/pub/wmglo/malloc-2.6.3f-64.c">ftp://md.dent.med.uni-muenchen.de/pub/wmglo/malloc-2.6.3f-64.c</a><br>
<p>
and a simple testing program, malloc-test.c, is also there (that<br>
is also untested under 64bit, but should work).  As a quick start,<br>
you could compile with<br>
<p>
% cc -O -DDEBUG -c malloc-2.6.3f-64.c<br>
        ^^^ to test for bugs (but executes much slower!)<br>
% cc -O malloc-test.c malloc-2.6.3f-64.o -o malloc-test<br>
% ./malloc-test<br>
% ./malloc-test 1000000 33000<br>
                ^^^     ^^^<br>
                ^^^     maximum size of a single allocation<br>
                total number of allocations<br>
etc.<br>
<p>
If this works for all sorts of allocation sizes (play with the second<br>
command line parameter to malloc-test), fine.  If not, I'd like to<br>
hear about it (please send me mail as I'm not on the Alpha mailing<br>
lists).  You might also want to link against a different malloc<br>
implementation (such as the one in your libc) and compare the `waste<br>
percentage' figures that `malloc-test' prints.<br>
<p>
Regards,<br>
Wolfram.<br>
<!-- body="end" -->
<p>
<ul>
<!-- next="start" -->
<li> <b>Next message:</b> <a href="0101.html">David Mosberger-Tang: "Re: Doug Lea's malloc adapted for 64bit, needs testing"</a>
<li> <b>Previous message:</b> <a href="0099.html">Craig Burley: "Re: GNU"</a>
<!-- nextthread="start" -->
<li> <b>Next in thread:</b> <a href="0101.html">David Mosberger-Tang: "Re: Doug Lea's malloc adapted for 64bit, needs testing"</a>
<li> <b>Maybe reply:</b> <a href="0101.html">David Mosberger-Tang: "Re: Doug Lea's malloc adapted for 64bit, needs testing"</a>
<!-- reply="end" -->
</ul>
<br clear=all>
<hr>
<center>
<a href="mailto:webmaster@redhat.com"   target="">Feedback</a> | 
<a href="http://www.redhat.com/products/"   target="">Store</a> | 
<a href="http://www.redhat.com/news/"   target="">News</a> | 
<a href="http://www.redhat.com/support/"   target="">Support</a> | 
<a href="http://www.redhat.com/support/docs/errata.html"   target="">Product Errata</a> | 
<a href="http://www.redhat.com/redhat/"   target="">About Us</a> | 
<a href="http://www.redhat.com/linux-info/"   target="">Linux Info</a> | 
<a href="http://www.redhat.com/search/"   target="">Search</a> | 
<a href="http://www.redhat.com/jumplist.phtml"   target="">JumpWords</a>
<br>
<a href="http://www.redhat.com/cgi-bin/frames.phtml?fr=n"  _top target="_top">No Frames</a> | 
<a href="http://www.redhat.com/cgi-bin/frames.phtml?fr=y"  _top target="_top">Show Frames</a>
</center>
<p align=center>
Copyright &copy; 1995-1997 Red Hat Software. <a href="http://www.redhat.com/redhat/website.html#legal"   target="">Legal notices</a>
</p>
</BODY></HTML>
