<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN"> 
     <HTML> 
     <HEAD> 
     <TITLE>Axp-List Archive</TITLE> 
     <LINK REV="made" HREF="mailto:mailto-address"> 
     <HEAD> 
     <BODY BGCOLOR="#DC9D33" TEXT="#000000" LINK="#DD0000" ALINK="#CC0000" VLINK="#CC0000">
		<CENTER>  <!--#exec cgi="/cgi-bin/banmat1.cgi"--></CENTER>

     <H1 ALIGN=CENTER>Axp-List Archive<BR> Re: XFree 4.0 crashes with SRM</H1> 
	
<!-- received="Thu Jun 01 00:32:15 2000" -->
<!-- isoreceived="20000601073215" -->
<!-- sent="31 May 2000 16:44:22 -0700" -->
<!-- isosent="20000531234422" -->
<!-- name="David Huggins-Daines" -->
<!-- email="dhd@linuxcare.com" -->
<!-- subject="Re: XFree 4.0 crashes with SRM" -->
<!-- id="874s7emgix.fsf@linuxcare.com" -->
<!-- inreplyto="3935A218.1B91FEDA@appnet.com" -->
<STRONG>Subject: </STRONG>Re: XFree 4.0 crashes with SRM<BR>
<STRONG>From: </STRONG>David Huggins-Daines (<EM>dhd@linuxcare.com</EM>)<BR>
<STRONG>Date: </STRONG>Wed May 31 16:44:22 2000
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.shtml#316">[ date ]</A>
<A HREF="index.shtml#316">[ thread ]</A>
<A HREF="subject.shtml#316">[ subject ]</A>
<A HREF="author.shtml#316">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0317.shtml">Michal Jaegermann: "Re: XFree 4.0 crashes with SRM"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0315.shtml">Jeff Sturm: "Re: XFree 4.0 crashes with SRM"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0315.shtml">Jeff Sturm: "Re: XFree 4.0 crashes with SRM"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0317.shtml">Michal Jaegermann: "Re: XFree 4.0 crashes with SRM"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0315.shtml">David Huggins-Daines: "Re: XFree 4.0 crashes with SRM"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Jeff Sturm &lt;jeff.sturm@appnet.com&gt; writes:
<BR>
<P><EM>&gt; Thanks Rich.  I ran XFree86 under gdb (remotely) to get some better
</EM><BR>
<EM>&gt; data.  It dies with a SIGILL in miIntersect():
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 0x120178258 &lt;miIntersect+280&gt;:	maxsw4	t6,t1,t1
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; That mean anything to anybody?  I'm using SRM V5.6-3, kernel 2.2.14.
</EM><BR>
<P>Yup.  SRM on the SX disables the MVI instructions.  Try this patch
<BR>
(from Ivan Koshaysky via linux-alpha@vger):
<BR>
<P>diff -urN linux-2.2.15-vanilla/arch/alpha/kernel/sys_sx164.c linux-2.2.15/arch/alpha/kernel/sys_sx164.c
<BR>
--- linux-2.2.15-vanilla/arch/alpha/kernel/sys_sx164.c	Mon Feb 22 04:06:36 1999
<BR>
+++ linux-2.2.15/arch/alpha/kernel/sys_sx164.c	Fri May 26 09:33:16 2000
<BR>
@@ -24,6 +24,7 @@
<BR>
&nbsp;#include &lt;asm/io.h&gt;
<BR>
&nbsp;#include &lt;asm/pgtable.h&gt;
<BR>
&nbsp;#include &lt;asm/core_pyxis.h&gt;
<BR>
+#include &lt;asm/hwrpb.h&gt;
<BR>
&nbsp;
<BR>
&nbsp;#include &quot;proto.h&quot;
<BR>
&nbsp;#include &quot;irq.h&quot;
<BR>
@@ -186,6 +187,35 @@
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SMC669_Init(0);
<BR>
&nbsp;}
<BR>
&nbsp;
<BR>
+static void __init
<BR>
+sx164_init_arch(unsigned long *mem_start, unsigned long *mem_end)
<BR>
+{
<BR>
+	/*
<BR>
+	 * OSF palcode v1.23 forgets to enable PCA56 Motion Video
<BR>
+	 * Instructions. Let's enable it.
<BR>
+	 * We have to check palcode revision because CSERVE interface
<BR>
+	 * is subject to change without notice. For example, it
<BR>
+	 * has been changed completely since v1.16 (found in MILO
<BR>
+	 * distribution). -ink
<BR>
+	 */
<BR>
+	struct percpu_struct *cpu = (struct percpu_struct*)
<BR>
+				((char*)hwrpb + hwrpb-&gt;processor_offset);
<BR>
+
<BR>
+	if (alpha_using_srm &amp;&amp; (cpu-&gt;pal_revision &amp; 0xffff) == 0x117) {
<BR>
+		__asm__ __volatile__(
<BR>
+		&quot;lda	$16,8($31)\n&quot;
<BR>
+		&quot;call_pal 9\n&quot;		/* Allow PALRES insns in kernel mode */
<BR>
+		&quot;.long	0x64000118\n&quot;	/* hw_mfpr $0,icsr */
<BR>
+		&quot;ldah	$16,(1&lt;&lt;(19-16))($31)\n&quot;
<BR>
+		&quot;or	$0,$16,$0\n&quot;	/* set MVE bit */
<BR>
+		&quot;.long  0x74000118\n&quot;	/* hw_mtpr $0,icsr */
<BR>
+		&quot;lda	$16,9($31)\n&quot;
<BR>
+		&quot;call_pal 9&quot;		/* Disable PALRES insns */
<BR>
+		: : : &quot;$0&quot;, &quot;$16&quot;);
<BR>
+		printk(&quot;PCA56 MVI set enabled\n&quot;);
<BR>
+	}
<BR>
+	pyxis_init_arch(mem_start, mem_end);
<BR>
+}
<BR>
&nbsp;
<BR>
&nbsp;/*
<BR>
&nbsp;&nbsp;* The System Vector
<BR>
@@ -206,7 +236,7 @@
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ack_irq:		generic_ack_irq,
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device_interrupt:	sx164_device_interrupt,
<BR>
&nbsp;
<BR>
-	init_arch:		pyxis_init_arch,
<BR>
+	init_arch:		sx164_init_arch,
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;init_irq:		sx164_init_irq,
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;init_pit:		generic_init_pit,
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pci_fixup:		sx164_pci_fixup,
<BR>
<P><P><PRE>
-- 
David Huggins-Daines, Senior GNU/Linux Consultant, Linuxcare, Inc.
613.562.1239 desk, 613.223.0225 mobile
dhd@linuxcare.com, <A HREF="http://www.linuxcare.com/">http://www.linuxcare.com/</A>
Linuxcare. Support for the revolution.
<P>-- 
To unsubscribe: send e-mail to axp-list-request@redhat.com with
'unsubscribe' as the subject.  Do not send it to axp-list@redhat.com
</PRE>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0317.shtml">Michal Jaegermann: "Re: XFree 4.0 crashes with SRM"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0315.shtml">Jeff Sturm: "Re: XFree 4.0 crashes with SRM"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0315.shtml">Jeff Sturm: "Re: XFree 4.0 crashes with SRM"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0317.shtml">Michal Jaegermann: "Re: XFree 4.0 crashes with SRM"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0315.shtml">David Huggins-Daines: "Re: XFree 4.0 crashes with SRM"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR> 
     <P> 
     <SMALL> 
     <EM> 
     This archive was generated by  <A HREF="http://www.landfield.com/hypermail">hypermail version 2a22 </A> on Thu Jun  1 09:46:25 2000 PDT <BR>
	Send any problems or questions about this archive to <A HREF="mailto:webmaster@alphalinux.org">webmaster@alphalinux.org</A>. 
     </EM> 
     </SMALL> 
     </BODY> 
     </HTML> 
