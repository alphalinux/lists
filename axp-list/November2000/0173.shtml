<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN"> 
     <HTML> 
     <HEAD> 
     <TITLE>Axp-List Archive</TITLE> 
     <LINK REV="made" HREF="mailto:mailto-address"> 
     <HEAD> 
     <BODY BGCOLOR="#DC9D33" TEXT="#000000" LINK="#DD0000" ALINK="#CC0000" VLINK="#CC0000">
		<CENTER>  <!--#exec cgi="/cgi-bin/banmat1.cgi"--></CENTER>

     <H1 ALIGN=CENTER>Axp-List Archive<BR> Re: PCI-PCI bridges mess in 2.4.x</H1> 
	
<!-- received="Wed Nov 08 04:22:33 2000" -->
<!-- isoreceived="20001108122233" -->
<!-- sent="Tue, 7 Nov 2000 18:32:35 -0700" -->
<!-- isosent="20001108013235" -->
<!-- name="Michal Jaegermann" -->
<!-- email="michal@ellpspace.math.ualberta.ca" -->
<!-- subject="Re: PCI-PCI bridges mess in 2.4.x" -->
<!-- id="20001107183235.A24123@ellpspace.math.ualberta.ca" -->
<!-- inreplyto="20001107161251.A3166@jurassic.park.msu.ru" -->
<STRONG>Subject: </STRONG>Re: PCI-PCI bridges mess in 2.4.x<BR>
<STRONG>From: </STRONG>Michal Jaegermann (<EM>michal@ellpspace.math.ualberta.ca</EM>)<BR>
<STRONG>Date: </STRONG>Tue Nov  7 17:32:35 2000
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.shtml#173">[ date ]</A>
<A HREF="index.shtml#173">[ thread ]</A>
<A HREF="subject.shtml#173">[ subject ]</A>
<A HREF="author.shtml#173">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0174.shtml">Larry Snyder: "Re: SCSI 68 vs 80 pin - any issue on Alpha ?"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0172.shtml">Andrei A. Dergatchev: "Re: SCSI 68 vs 80 pin - any issue on Alpha ?"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0139.shtml">Ivan Kokshaysky: "Re: PCI-PCI bridges mess in 2.4.x"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0180.shtml">Richard Henderson: "Re: PCI-PCI bridges mess in 2.4.x"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0139.shtml">Michal Jaegermann: "Re: PCI-PCI bridges mess in 2.4.x"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
OK, so I booted after all UX with 2.4.0-test10, patched with a patch
<BR>
from Ivan - of course, but mounting things only from an IDE disk and not
<BR>
SCSI (a used kernel still resided on a SCSI device as it was read only
<BR>
by milo :-).
<BR>
<P>Here are some pieces of boot messages (reformatted).  The complete record is
<BR>
attached below: 
<BR>
<P>Linux version 2.4.0-test10 (root@toaster.home.front) (gcc version
<BR>
2.95.2 19991024 (release)) #7 Tue Nov 7 08:24:49 MST 2000
<BR>
Booting GENERIC on Ruffian using machine vector Ruffian from MILO
<BR>
Command line: bootdevice=sda2 bootfile=/vml240t10.gz root=/dev/hda2
<BR>
sym53c8xx=safe:y Å∏Å´
<BR>
....
<BR>
PIIX3: not 100% native mode: will probe irqs later
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;ide0: BM-DMA at 0x8080-0x8087, BIOS settings: hda:DMA, hdb:DMA
<BR>
hda: IBM-DJNA-370910, ATA DISK drive
<BR>
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
<BR>
hda: 17803440 sectors (9115 MB) w/1966KiB Cache, CHS=17662/16/63, (U)DMA
<BR>
Partition check:
<BR>
&nbsp;hda: hda1 hda2 hda3 hda4
<BR>
...
<BR>
SCSI subsystem driver Revision: 1.00
<BR>
sym53c8xx: setup=disc:n,specf:0,ultra:0,tags:0,sync:255,burst:255,
<BR>
wide:n,diff:1,revprob:n,buschk:0x1
<BR>
sym53c8xx: setup=mpar:n,spar:y,fsn=n,verb:2,debug:0x0,led:n,settle:10,
<BR>
irqm:0x1,nvram:0x1,pcifix:0x0
<BR>
sym53c8xx: at PCI bus 1, device 13, function 0
<BR>
sym53c8xx: 53c875 detected 
<BR>
sym53c875-0: rev 0x3 on pci bus 1 device 13 function 0 irq 20
<BR>
sym53c875-0: clock multiplier found
<BR>
sym53c875-0: ID 7, Fast-10, Parity Checking, Differential
<BR>
sym53c875-0: initial SCNTL3/DMODE/DCNTL/CTEST3/4/5 = (hex) 07/ce/a8/01/80/24
<BR>
sym53c875-0: final   SCNTL3/DMODE/DCNTL/CTEST3/4/5 = (hex) 05/00/08/00/80/00
<BR>
CACHE TEST FAILED: script execution failed.
<BR>
start=4fe34dd8, pc=ffffffff, end=4fe34df8
<BR>
CACHE INCORRECTLY CONFIGURED.
<BR>
sym53c875-0: giving up ...
<BR>
<P>This time sym53c875 was correctly detected (with rev 0x3) but on other
<BR>
occasion I managed to boot as well and then I got (rev 0xff this time):
<BR>
<P>sym53c8xx: at PCI bus 1, device 13, function 0
<BR>
sym53c8xx: 53c876 detected 
<BR>
sym53c876-0: rev 0xff on pci bus 1 device 13 function 0 irq 20
<BR>
sym53c876-0: clock multiplier found
<BR>
sym53c876-0: ID 7, Fast-10, Parity Checking, Differential
<BR>
sym53c876-0: initial SCNTL3/DMODE/DCNTL/CTEST3/4/5 = (hex) 07/ce/a8/01/80/24
<BR>
sym53c876-0: final   SCNTL3/DMODE/DCNTL/CTEST3/4/5 = (hex) 05/00/08/00/80/00
<BR>
CACHE TEST FAILED: script execution failed.
<BR>
start=4fe34dd8, pc=ffffffff, end=4fe34df8
<BR>
CACHE INCORRECTLY CONFIGURED.
<BR>
sym53c876-0: giving up ...
<BR>
<P>so the correct detection is not a requirement or a solution.
<BR>
<P>First for good news.  Once booted other PCI devices show up correctly
<BR>
<P>-[00]-+-0d.0-[01]--+-0a.0  Trident Microsystems 4DWave DX
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|            \-0d.0  Symbios Logic Inc. (formerly NCR) 53c875
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+-0e.0  Intel Corporation 82371SB PIIX3 ISA [Natoma/Triton II]
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+-0e.1  Intel Corporation 82371SB PIIX3 IDE [Natoma/Triton II]
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+-0f.0  Digital Equipment Corporation DECchip 21142/43
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\-11.0  Texas Instruments TVP4020 [Permedia 2]
<BR>
<P>and, in particular a network card on 00:0f.0 works, can be configured,
<BR>
and communicates.
<BR>
<P>And not so good news.  You notice 'sym53c8xx=safe:y Å∏Å´'.  The garbage
<BR>
at the end of this string is not typed by me but inserted by kernel.
<BR>
Some problems with a parsing of a command line.  'sym53c8xx=safe:y'
<BR>
seems to be essential.  Without this argument I did not manage to boot
<BR>
even once.
<BR>
<P>It looks like that something is stomping heavily on a memory.  In
<BR>
particular I did not manage to boot _once_ on the first try from
<BR>
a power-up or after a reset.  Usually it was possible to boot on 
<BR>
the second try.  Third and fourth were causing either &quot;abort/reset&quot;
<BR>
cycle from a SCSI controller trying to configure itself or machine
<BR>
lockups either immediately after this line 
<BR>
<P>sym53c875-0: rev 0x3 on pci bus 1 device 13 function 0 irq 20
<BR>
&nbsp;&nbsp;
<BR>
or a bit later.  Some lockups were accompanied by a video corruption
<BR>
with patterns of rectangles in various colours at the bottom of my
<BR>
screen.
<BR>
<P>Without 'sym53c8xx=safe:y' I had always either &quot;abort/reset&quot; loop
<BR>
or a lockup in some moment.
<BR>
<P>If you would like to look at details I attach below full dmesg output
<BR>
from one succesful boot, and output from 'lspci -vvx', listing of
<BR>
/proc/bus and results of 'cat /proc/bus/pci/devices'.
<BR>
<P><P>&nbsp;&nbsp;Michal
<BR>
<P><HR>
<UL>
<LI>application/x-gunzip attachment: <A HREF="att-bin3iAEPlO">stored</A>
</UL>
<!-- attachment="att-bin3iAEPlO" -->
<HR>
<UL>
<LI>application/x-gunzip attachment: <A HREF="att-bin4zoFj37">stored</A>
</UL>
<!-- attachment="att-bin4zoFj37" -->
<HR>
<UL>
<LI>application/x-gunzip attachment: <A HREF="att-bin5qjshEr">stored</A>
</UL>
<!-- attachment="att-bin5qjshEr" -->
<HR>
<UL>
<LI>application/x-gunzip attachment: <A HREF="att-bin632wxZK">stored</A>
</UL>
<!-- attachment="att-bin632wxZK" -->
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0174.shtml">Larry Snyder: "Re: SCSI 68 vs 80 pin - any issue on Alpha ?"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0172.shtml">Andrei A. Dergatchev: "Re: SCSI 68 vs 80 pin - any issue on Alpha ?"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0139.shtml">Ivan Kokshaysky: "Re: PCI-PCI bridges mess in 2.4.x"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0180.shtml">Richard Henderson: "Re: PCI-PCI bridges mess in 2.4.x"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0139.shtml">Michal Jaegermann: "Re: PCI-PCI bridges mess in 2.4.x"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR> 
     <P> 
     <SMALL> 
     <EM> 
     This archive was generated by  <A HREF="http://www.landfield.com/hypermail">hypermail version 2a22 </A> on Fri Dec  1 08:00:06 2000 PST <BR>
	Send any problems or questions about this archive to <A HREF="mailto:webmaster@alphalinux.org">webmaster@alphalinux.org</A>. 
     </EM> 
     </SMALL> 
     </BODY> 
     </HTML> 
