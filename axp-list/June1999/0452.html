<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>axp-list: bug in fbmem.c,</TITLE>
<META NAME="Author" CONTENT="Vignaud Jean-Baptiste (jbv@club-internet.fr)">
<META NAME="Subject" CONTENT="bug in fbmem.c,">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>bug in fbmem.c,</H1>
<HR>
<P>
<!-- received="Tue Jun 22 09:53:53 1999" -->
<!-- isoreceived="19990622165353" -->
<!-- sent="Tue, 22 Jun 1999 10:57:12 +0200" -->
<!-- isosent="19990622085712" -->
<!-- name="Vignaud Jean-Baptiste" -->
<!-- email="jbv@club-internet.fr" -->
<!-- subject="bug in fbmem.c," -->
<!-- id="000d01bebc8d$37b25fc0$cc000001@PC_VIGNAUD.xandmail.com" -->
<STRONG>Subject: </STRONG>bug in fbmem.c,<BR>
<STRONG>From: </STRONG>Vignaud Jean-Baptiste (<EM>jbv@club-internet.fr</EM>)<BR>
<STRONG>Date: </STRONG>Tue Jun 22 1999 - 01:57:12 PDT
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#452">[ date ]</A>
<A HREF="index.html#452">[ thread ]</A>
<A HREF="subject.html#452">[ subject ]</A>
<A HREF="author.html#452">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0453.html">Nils Faerber: "Re: mp3 encoders on linux/alpha..."</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0451.html">Nils Faerber: "Re: mp3 encoders on linux/alpha..."</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0456.html">Vignaud Jean-Baptiste: "RE: bug in fbmem.c,"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Hi,
<BR>
<P>I'v traced a little bug in the fbmem code. i don't know if it's the right
<BR>
way to
<BR>
correct it, but on my SX164 alpha this seems to work.
<BR>
<P>before the patch: cat /dev/fb0 &gt; foo end with an execption.
<BR>
after the patch: cat /dev/fb0 &gt; foo ; cat foo &gt; /dev/fb0 work.
<BR>
<P>There are others problems with the fbdriver on alpha:
<BR>
mmapping the /dev/fb0 and writing to it give me a *RANDOM* 'PYXIS machine
<BR>
check NOT expected'
<BR>
with no effect on the screen.
<BR>
Maybe someone have an idea?
<BR>
<P><P>Jean-Baptiste Vignaud.
<BR>
<P>--- fbmem.c     Wed Mar 17 18:17:22 1999
<BR>
+++ fbmem.c.new Tue Jun 22 11:04:03 1999
<BR>
@@ -30,7 +30,7 @@
<BR>
&nbsp;#if defined(__mc68000__) || defined(CONFIG_APUS)
<BR>
&nbsp;#include &lt;asm/setup.h&gt;
<BR>
&nbsp;#endif
<BR>
-#ifdef __powerpc__
<BR>
+#if defined(__powerpc__) || defined(__alpha__)
<BR>
&nbsp;#include &lt;asm/io.h&gt;
<BR>
&nbsp;#endif
<BR>
&nbsp;#include &lt;asm/uaccess.h&gt;
<BR>
@@ -251,8 +251,7 @@
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fb-&gt;fb_get_fix(&amp;fix,PROC_CONSOLE(), info);
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base_addr=info-&gt;disp-&gt;screen_base;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy_size=(count + p &lt;= fix.smem_len ? count : fix.smem_len - p);
<BR>
-       if (copy_to_user(buf, base_addr+p, copy_size))
<BR>
-           return -EFAULT;
<BR>
+       memcpy_fromio(buf, base_addr+p, copy_size);
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*ppos += copy_size;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return copy_size;
<BR>
&nbsp;}
<BR>
@@ -275,8 +274,7 @@
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fb-&gt;fb_get_fix(&amp;fix, PROC_CONSOLE(), info);
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base_addr=info-&gt;disp-&gt;screen_base;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy_size=(count + p &lt;= fix.smem_len ? count : fix.smem_len - p);
<BR>
-       if (copy_from_user(base_addr+p, buf, copy_size))
<BR>
-           return -EFAULT;
<BR>
+       memcpy_toio(base_addr+p, buf, copy_size);
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file-&gt;f_pos += copy_size;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return copy_size;
<BR>
&nbsp;}
<BR>
<P><P><PRE>
-- 
To unsubscribe: send e-mail to axp-list-request@redhat.com with
'unsubscribe' as the subject.  Do not send it to axp-list@redhat.com
</PRE>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0453.html">Nils Faerber: "Re: mp3 encoders on linux/alpha..."</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0451.html">Nils Faerber: "Re: mp3 encoders on linux/alpha..."</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0456.html">Vignaud Jean-Baptiste: "RE: bug in fbmem.c,"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.www.fts.frontec.se/~dast/hypermail/">hypermail 2a22</A> 
: <EM>Wed Jun 30 1999 - 19:27:27 PDT</EM>
</EM>
</SMALL>
</BODY>
</HTML>
