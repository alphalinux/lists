<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN"> 
     <HTML> 
     <HEAD> 
     <TITLE>Axp-List Archive</TITLE> 
     <LINK REV="made" HREF="mailto:mailto-address"> 
     <HEAD> 
     <BODY BGCOLOR="#DC9D33" TEXT="#000000" LINK="#DD0000" ALINK="#CC0000" VLINK="#CC0000">
		<CENTER>  <!--#exec cgi="/cgi-bin/banmat1.cgi"--></CENTER>

     <H1 ALIGN=CENTER>Axp-List Archive<BR> Re: 2.2.14pre13 - exception in __copy_user when running mount()</H1> 
	
<!-- received="Thu Dec 16 23:06:27 1999" -->
<!-- isoreceived="19991217070627" -->
<!-- sent="Thu, 16 Dec 1999 16:04:46 -0700 (MST)" -->
<!-- isosent="19991216230446" -->
<!-- name="Michal Jaegermann" -->
<!-- email="michal@ellpspace.math.ualberta.ca" -->
<!-- subject="Re: 2.2.14pre13 - exception in __copy_user when running mount()" -->
<!-- id="199912162304.QAA07583@ellpspace.math.ualberta.ca" -->
<!-- inreplyto="2.2.14pre13 - exception in __copy_user when running mount()" -->
<STRONG>Subject: </STRONG>Re: 2.2.14pre13 - exception in __copy_user when running mount()<BR>
<STRONG>From: </STRONG>Michal Jaegermann (<EM>michal@ellpspace.math.ualberta.ca</EM>)<BR>
<STRONG>Date: </STRONG>Thu Dec 16 15:04:46 1999
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.shtml#543">[ date ]</A>
<A HREF="index.shtml#543">[ thread ]</A>
<A HREF="subject.shtml#543">[ subject ]</A>
<A HREF="author.shtml#543">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0544.shtml">Larry Snyder: "Re: IntelExpress Pro+ on AXPpci33 + RH 6.0"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0542.shtml">Zbigniew Podziewski: "IntelExpress Pro+ on AXPpci33 + RH 6.0"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0549.shtml">David S. Miller: "Re: 2.2.14pre13 - exception in __copy_user when running mount()"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Ok, this particular code change in 2.2.14-pre1[34] is responsible
<BR>
for an exception in __copy_user on every attemp to mount or unmount
<BR>
a file system (at least ext2 file system).
<BR>
<P>--- linux-2.2.14/fs/super.c	Sun Dec  5 15:24:34 1999
<BR>
+++ linux-2.2.14p/fs/super.c	Thu Dec 16 10:21:38 1999
<BR>
@@ -983,6 +983,7 @@
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!data)
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;
<BR>
&nbsp;
<BR>
+#if 0
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vma = find_vma(current-&gt;mm, (unsigned long) data);
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!vma || (unsigned long) data &lt; vma-&gt;vm_start)
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -EFAULT;
<BR>
@@ -991,13 +992,13 @@
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i = vma-&gt;vm_end - (unsigned long) data;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (PAGE_SIZE &lt;= (unsigned long) i)
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i = PAGE_SIZE-1;
<BR>
-	if (!(page = __get_free_page(GFP_KERNEL))) {
<BR>
+#else
<BR>
+	i = PAGE_SIZE;		
<BR>
+#endif		
<BR>
+	if (!(page = get_free_page(GFP_KERNEL))) {
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -ENOMEM;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<BR>
-	if (copy_from_user((void *) page,data,i)) {
<BR>
-		free_page(page); 
<BR>
-		return -EFAULT;
<BR>
-	}
<BR>
+	copy_from_user((void *) page,data,i);
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*where = page;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;
<BR>
&nbsp;}
<BR>
<P>Who own to this change, why it was done and what is missing?
<BR>
<P>An exception in question appears to happen in the follwing code
<BR>
from arch/alpha/lib/copy_user.S:
<BR>
<P>........
<BR>
&nbsp;&nbsp;&nbsp;100		subq $0,1,$0
<BR>
&nbsp;&nbsp;&nbsp;101		addq $6,1,$6
<BR>
&nbsp;&nbsp;&nbsp;102		addq $7,1,$7
<BR>
&nbsp;&nbsp;&nbsp;103		bne $0,$57
<BR>
&nbsp;&nbsp;&nbsp;104		br $31,$41
<BR>
&nbsp;&nbsp;&nbsp;105		.align 4
<BR>
&nbsp;&nbsp;&nbsp;106	$43:
<BR>
&nbsp;&nbsp;&nbsp;107		beq $4,$65
<BR>
&nbsp;&nbsp;&nbsp;108		.align 5
<BR>
&nbsp;&nbsp;&nbsp;109	$66:
<BR>
&nbsp;&nbsp;&nbsp;110		EXI( ldq $1,0($7) )   &lt;---- here!!!
<BR>
&nbsp;&nbsp;&nbsp;111		subq $4,8,$4
<BR>
&nbsp;&nbsp;&nbsp;112		EXO( stq $1,0($6) )
<BR>
&nbsp;&nbsp;&nbsp;113		addq $7,8,$7
<BR>
&nbsp;&nbsp;&nbsp;114		subq $0,8,$0
<BR>
&nbsp;&nbsp;&nbsp;115		addq $6,8,$6
<BR>
&nbsp;&nbsp;&nbsp;116		bne $4,$66
<BR>
................
<BR>
<P>&nbsp;&nbsp;&nbsp;Michal
<BR>
<P><PRE>
-- 
To unsubscribe: send e-mail to axp-list-request@redhat.com with
'unsubscribe' as the subject.  Do not send it to axp-list@redhat.com
</PRE>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0544.shtml">Larry Snyder: "Re: IntelExpress Pro+ on AXPpci33 + RH 6.0"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0542.shtml">Zbigniew Podziewski: "IntelExpress Pro+ on AXPpci33 + RH 6.0"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0549.shtml">David S. Miller: "Re: 2.2.14pre13 - exception in __copy_user when running mount()"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR> 
     <P> 
     <SMALL> 
     <EM> 
     This archive was generated by  <A HREF="http://www.landfield.com/hypermail">hypermail version 2a22 </A> on Mon Jan  3 11:15:10 2000 PST <BR>
	Send any problems or questions about this archive to <A HREF="mailto:webmaster@alphalinux.org">webmaster@alphalinux.org</A>. 
     </EM> 
     </SMALL> 
     </BODY> 
     </HTML> 
