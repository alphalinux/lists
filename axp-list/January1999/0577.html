<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>axp-list: Re: rpcc</TITLE>
<META NAME="Author" CONTENT="Peter Petrakis (peterpan@wn.net)">
<META NAME="Subject" CONTENT="Re: rpcc">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: rpcc</H1>
<HR>
<P>
<!-- received="Tue Jan 12 03:21:34 1999 PST" -->
<!-- sent="Mon, 11 Jan 1999 22:20:06 -0500" -->
<!-- name="Peter Petrakis" -->
<!-- email="peterpan@wn.net" -->
<!-- subject="Re: rpcc" -->
<!-- id="369ABF66.FFFD67EE@wn.net" -->
<!-- inreplyto="278e88a7.u10t12e.df8c-axp@amazing.ch" -->
<STRONG>Peter Petrakis</STRONG> (<A HREF="mailto:peterpan@wn.net?subject=Re:%20rpcc"><EM>peterpan@wn.net</EM></A>)<BR>
<EM>Mon, 11 Jan 1999 22:20:06 -0500</EM>
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#577">[ date ]</A>
<A HREF="index.html#577">[ thread ]</A>
<A HREF="subject.html#577">[ subject ]</A>
<A HREF="author.html#577">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0578.html">Dan Morrill: "Slow tar under 2.2.0-pre3"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0576.html">Christoph Dworzak: "rpcc"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0580.html">Richard Henderson: "Re: rpcc"</A>
</UL>
<HR>
<!-- body="start" -->
<P>
Do you know how to profile your code? Here's an example. Say I have a
<BR>
single source file called hello.c and i want to find out what calls it
<BR>
makes , how many times the calls are made, percent of time spent etc
<BR>
etc. I do this at the command line.
<BR>
<P>gcc -p -o hello hello.c
<BR>
<P>The -p flag generates code sutible for the profiler and the &quot;hello&quot; is
<BR>
the name of the binary executable. Now execute hello.
<BR>
<P>./hello
<BR>
<P>Hello World
<BR>
<P>Wow, fancy. Now to see how it spent it's time. do
<BR>
<P>gprof hello
<BR>
<P>And you'll get something like this 
<BR>
<P>Flat profile:
<BR>
<P>Each sample counts as 0.000976562 seconds.
<BR>
no time accumulated
<BR>
<P>&nbsp;%   cumulative   self              self     total           
<BR>
&nbsp;time   seconds   seconds    calls  Ts/call  Ts/call  name    
<BR>
&nbsp;0.00      0.00     0.00        1     0.00     0.00  main
<BR>
........
<BR>
<P>I hope this is has some use. BTW any good text on C will detail how to
<BR>
do this.
<BR>
I learned the from &quot;A book on C&quot; which you can find at amazon.com 
<BR>
<P>Peter P.
<BR>
<P>Christoph Dworzak wrote:
<BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Hi
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; With some help from this list, I'm getting better
</EM><BR>
<EM>&gt; with axp-asm :)
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Now my next question is, how do I measure the speed
</EM><BR>
<EM>&gt; of my code?
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; My test looks like this:
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; --------------------------------------------------------
</EM><BR>
<EM>&gt; unsigned long c1, c2, ccm=~0UL, ccs=0, n;
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; for (n=0; n&lt;(1UL&lt;&lt;19); n++){
</EM><BR>
<EM>&gt;     asm volatile(&quot;rpcc %0&quot; : &quot;=r&quot;(c1) : : &quot;memory&quot;);
</EM><BR>
<EM>&gt;     core();
</EM><BR>
<EM>&gt;     asm volatile(&quot;rpcc %0&quot; : &quot;=r&quot;(c2) : : &quot;memory&quot;);
</EM><BR>
<EM>&gt;     c1 = (c1 + (c1&lt;&lt;32)) &gt;&gt; 32;
</EM><BR>
<EM>&gt;     c2 = (c2 + (c2&lt;&lt;32)) &gt;&gt; 32;
</EM><BR>
<EM>&gt;     c2 = (c2&gt;c1) ? c2-c1 : c2+(1UL&lt;&lt;32)-c1;
</EM><BR>
<EM>&gt;     ccs += c2;
</EM><BR>
<EM>&gt;     if (c2&lt;ccm) ccm = c2;
</EM><BR>
<EM>&gt; }
</EM><BR>
<EM>&gt; printf(&quot;\nMin=%ld Avg=%ld\n\n&quot;, ccm, ccs/n;
</EM><BR>
<EM>&gt; --------------------------------------------------------
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; When I run this several times, I get strange results
</EM><BR>
<EM>&gt; (see end of my mail)
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Why does it take up to 50% longer sometimes? (it really
</EM><BR>
<EM>&gt; does, checking with my wrist-watch.)
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Of course I know, there are some task-switches or interupts,
</EM><BR>
<EM>&gt; but I would expect, that at least one loop out of one million
</EM><BR>
<EM>&gt; runs uninteruptet on full speed...
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Has it something to do with alignment of the code in memory
</EM><BR>
<EM>&gt; and if so, how could I place the code so it runs at full speed?
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Bye
</EM><BR>
<EM>&gt;  dworz
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; --------------------------------------------------------
</EM><BR>
<EM>&gt; [&gt; [dworz@really speed]# time ./speedtest
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Min=6063 Avg=6552
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 13.85user 0.00system 0:15.11elapsed 91%CPU (0avgtext+0avgdata 0maxresident)k
</EM><BR>
<EM>&gt; 0inputs+0outputs (69major+14minor)pagefaults 0swaps
</EM><BR>
<EM>&gt; [&gt; [dworz@really speed]# time ./speedtest
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Min=6065 Avg=6546
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 13.84user 0.00system 0:15.54elapsed 89%CPU (0avgtext+0avgdata 0maxresident)k
</EM><BR>
<EM>&gt; 0inputs+0outputs (69major+14minor)pagefaults 0swaps
</EM><BR>
<EM>&gt; [&gt; [dworz@really speed]# time ./speedtest
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Min=7961 Avg=8975
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 18.93user 0.00system 0:20.66elapsed 91%CPU (0avgtext+0avgdata 0maxresident)k
</EM><BR>
<EM>&gt; 0inputs+0outputs (69major+14minor)pagefaults 0swaps
</EM><BR>
<EM>&gt; [&gt; [dworz@really speed]# time ./speedtest
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Min=6063 Avg=6532
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 13.80user 0.00system 0:15.52elapsed 88%CPU (0avgtext+0avgdata 0maxresident)k
</EM><BR>
<EM>&gt; 0inputs+0outputs (69major+14minor)pagefaults 0swaps
</EM><BR>
<EM>&gt; [&gt; [dworz@really speed]# time ./speedtest
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Min=7975 Avg=8970
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 18.92user 0.00system 0:20.66elapsed 91%CPU (0avgtext+0avgdata 0maxresident)k
</EM><BR>
<EM>&gt; 0inputs+0outputs (69major+14minor)pagefaults 0swaps
</EM><BR>
<EM>&gt; [&gt; [dworz@really speed]# time ./speedtest
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Min=6062 Avg=6477
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 13.69user 0.00system 0:14.96elapsed 91%CPU (0avgtext+0avgdata 0maxresident)k
</EM><BR>
<EM>&gt; 0inputs+0outputs (69major+14minor)pagefaults 0swaps
</EM><BR>
<EM>&gt; [&gt; [dworz@really speed]# time ./speedtest
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Min=6063 Avg=6520
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 13.78user 0.00system 0:15.06elapsed 91%CPU (0avgtext+0avgdata 0maxresident)k
</EM><BR>
<EM>&gt; 0inputs+0outputs (69major+14minor)pagefaults 0swaps
</EM><BR>
<EM>&gt; --------------------------------------------------------
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; --
</EM><BR>
<EM>&gt; To unsubscribe: send e-mail to <A HREF="mailto:axp-list-request@redhat.com?subject=Re:%20rpcc">axp-list-request@redhat.com</A> with
</EM><BR>
<EM>&gt; 'unsubscribe' as the subject.  Do not send it to <A HREF="mailto:axp-list@redhat.com?subject=Re:%20rpcc">axp-list@redhat.com</A>
</EM><BR>
<P><PRE>
-- 
STCC DEC Alpha Resource Page
<A HREF="http://math.stcc.mass.edu/petrakis">http://math.stcc.mass.edu/petrakis</A>
<A HREF="mailto:PeterPan@wn.net?subject=Re:%20rpcc">PeterPan@wn.net</A>  AlphaGuy =)
&quot;BLAM! Who the hell are you!? Name's Ash &lt;click clock&gt; Housewares...&quot;
<P><PRE>
-- 
To unsubscribe: send e-mail to <A HREF="mailto:axp-list-request@redhat.com?subject=Re:%20rpcc">axp-list-request@redhat.com</A> with
'unsubscribe' as the subject.  Do not send it to <A HREF="mailto:axp-list@redhat.com?subject=Re:%20rpcc">axp-list@redhat.com</A>
</PRE>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0578.html">Dan Morrill: "Slow tar under 2.2.0-pre3"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0576.html">Christoph Dworzak: "rpcc"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0580.html">Richard Henderson: "Re: rpcc"</A>
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.landfield.com/hypermail/">hypermail 2.0b3</A> 
on <EM>Sun Jan 24 1999 - 14:47:49 PST</EM>
</EM>
</SMALL>
</BODY>
</HTML>
