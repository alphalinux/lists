<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>axp-list: [PATCH] PCI in 2.3.15</TITLE>
<META NAME="Author" CONTENT="Mitchell Blank Jr (mitch@sfgoth.com)">
<META NAME="Subject" CONTENT="[PATCH] PCI in 2.3.15">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>[PATCH] PCI in 2.3.15</H1>
<HR>
<P>
<!-- received="Thu Aug 26 09:17:47 1999" -->
<!-- isoreceived="19990826161747" -->
<!-- sent="Thu, 26 Aug 1999 01:27:54 -0700" -->
<!-- isosent="19990826082754" -->
<!-- name="Mitchell Blank Jr" -->
<!-- email="mitch@sfgoth.com" -->
<!-- subject="[PATCH] PCI in 2.3.15" -->
<!-- id="19990826012754.A80386@sfgoth.com" -->
<STRONG>Subject: </STRONG>[PATCH] PCI in 2.3.15<BR>
<STRONG>From: </STRONG>Mitchell Blank Jr (<EM>mitch@sfgoth.com</EM>)<BR>
<STRONG>Date: </STRONG>Thu Aug 26 1999 - 01:27:54 PDT
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#623">[ date ]</A>
<A HREF="index.html#623">[ thread ]</A>
<A HREF="subject.html#623">[ subject ]</A>
<A HREF="author.html#623">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0624.html">Sven Veckes: "RE: DS-10 Boot Problems"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0622.html">Lucas De Lamper: "RE: DS-10 Boot Problems"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0626.html">Ivan Kokshaysky: "Re: [PATCH] PCI in 2.3.15"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
As some of you noticed, alpha stopped working (again :-) in 2.3.15pre3
<BR>
due to the merge of the new PCI code.  Here is a half-assed attempt
<BR>
to fix it:
<BR>
<P>It does:
<BR>
&nbsp;&nbsp;* ...compile
<BR>
<P>&nbsp;&nbsp;* ...work on my SX164
<BR>
<P>It does not:
<BR>
&nbsp;&nbsp;* ...switch to the new way of using resource_allocate() to pick I/O and
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;MEM regions ala i386.  I actually spent a couple hours writing
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;that, and finally gave up and threw the code away.  Basically
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;you have to do a multilevel resource thing with
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;ioport_resource ==&gt; hose ==&gt; dev-&gt;resource[i]
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;iomem_resource ==&gt; hose ==&gt; segment ==&gt; dev-&gt;resource[i]
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;(the segment thing in the iomem is to implement the spaces
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;for the ISA holes in each 128M segment)  Oh yeah, and somehow
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;make sure the holes don't step on each other.  And make sure
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;this works on all the possible types of alpha.  I had a lot
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;of this figured out, but I didn't see a good way of programming
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;the bridge in layout_bus() - the tmem/bmem stuff, so I punted.
<BR>
<P>&nbsp;&nbsp;* ...work on multi-hose machines (probably).  I don't understand what
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;the linked list fixup in layout_one_hose() is trying to accomplish,
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;so I probably didn't fix it right :-)  Someone in the know: please
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;take a look.
<BR>
<P>&nbsp;&nbsp;* ...win any beauty contents.  There are still many things in bios32.c
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;that are calls into compat.c which isn't the nicest state of
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;affairs.  Some of them are trivial to fix, some would be a little
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;more involved.  Not a big deal, really.
<BR>
<P>Anyway I'll let rth decide if there's anything in there worth merging.
<BR>
If you're itching to play with 2.3.15 on a PCI alpha you might want
<BR>
to check it out.  Of course I'm still not a PCI wizard, so be careful
<BR>
out there.
<BR>
<P>-Mitch
<BR>
<P><P><HR>
<UL>
<LI>application/x-gunzip attachment: <A HREF="att-bin4II1Qdb">stored</A>
</UL>
<!-- attachment="att-bin4II1Qdb" -->
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0624.html">Sven Veckes: "RE: DS-10 Boot Problems"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0622.html">Lucas De Lamper: "RE: DS-10 Boot Problems"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0626.html">Ivan Kokshaysky: "Re: [PATCH] PCI in 2.3.15"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.www.fts.frontec.se/~dast/hypermail/">hypermail 2a22</A> 
: <EM>Tue Sep 07 1999 - 16:15:03 PDT</EM>
</EM>
</SMALL>
</BODY>
</HTML>
