<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>axp-list: Re: Unaligned traps et al</TITLE>
<META NAME="Author" CONTENT="Sean Hunter (sean@uncarved.co.uk)">
<META NAME="Subject" CONTENT="Re: Unaligned traps et al">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: Unaligned traps et al</H1>
<HR>
<P>
<!-- received="Wed Aug 18 21:50:50 1999" -->
<!-- isoreceived="19990819045050" -->
<!-- sent="Wed, 18 Aug 1999 22:23:49 +0100" -->
<!-- isosent="19990818212349" -->
<!-- name="Sean Hunter" -->
<!-- email="sean@uncarved.co.uk" -->
<!-- subject="Re: Unaligned traps et al" -->
<!-- id="19990818222349.W28508@henry.uncarved.co.uk" -->
<!-- inreplyto="199908181556.JAA28448@ellpspace.math.ualberta.ca" -->
<STRONG>Subject: </STRONG>Re: Unaligned traps et al<BR>
<STRONG>From: </STRONG>Sean Hunter (<EM>sean@uncarved.co.uk</EM>)<BR>
<STRONG>Date: </STRONG>Wed Aug 18 1999 - 14:23:49 PDT
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#437">[ date ]</A>
<A HREF="index.html#437">[ thread ]</A>
<A HREF="subject.html#437">[ subject ]</A>
<A HREF="author.html#437">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0438.html">Jano Lukac: "Re: Unaligned traps et al"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0436.html">Sean Hunter: "Re: kmem_alloc: Bad poison (name=size-256) (fwd)"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0441.html">Richard Henderson: "Re: Unaligned traps et al"</A>
<LI><STRONG>Maybe reply:</STRONG> <A HREF="0426.html">Sean Hunter: "Re: Unaligned traps et al"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Thanks for your rousing call to &quot;go buy a clue&quot;.  Results follow.
<BR>
<P>On Wed, Aug 18, 1999 at 09:56:48AM -0600, Michal Jaegermann wrote:
<BR>
<EM>&gt; &gt; 
</EM><BR>
<EM>&gt; &gt; 1)A lot of programs (eg rh6 ping)
</EM><BR>
<P>[stuff incl useful snippet of code re unaligned snipped]
<BR>
<P>I had a feeling that this was a FAQ, but searching the FAQ didn't
<BR>
uncover it.  Perhaps I should submit this to the FAQ...
<BR>
<P>Anyway, you've got me thing about a possibly useful kernel patch.  I'm
<BR>
going to send this to the list first to get people's opinions.  I'm
<BR>
going to have a go at writing this iover the next couple of weeks if
<BR>
people think it would be a good idea.  (I have done a few similar
<BR>
things in the past).
<BR>
<P>For those who don't know, its possible (as Michal told me, and rth's
<BR>
code snippet demonstrated) to exercise a small degree of control over
<BR>
what the kernel does when an app encounters an unaligned access.  In
<BR>
particular, you can turn off the message, tell the kernel not to fix
<BR>
the access (this sounds like a bad idea), or (more usefully) get the
<BR>
kernel to send the app a SIGBUS, causing it to dump core.  You can
<BR>
then plug the coredump into your favourite debugger and fix the
<BR>
access.
<BR>
<P>The trouble is, you need to use setsysinfo to get your program to do
<BR>
this, which is fine for stuff you're writing, but a pain for other
<BR>
programs.  What I propose is to set up a sysctl so that it will
<BR>
automatically set this behaviour as desired.  This means that normally 
<BR>
you just leave this as is, bit if you feel like doing a spot o'
<BR>
debugging you can echo &quot;some_magic&quot; &gt;&gt; /proc/sys/kernel/uac_control,
<BR>
and all newly-started process will automatically have the correct
<BR>
behaviour set in the tss, and will SIGBUS and coredump on encountering 
<BR>
the unaligned trap.  Similarly, if you attempting to show a prototype
<BR>
port to your boss, and don't what to be embarrassed by the unaligned
<BR>
traps you haven't fixed yet, you echo some magic to the same place to
<BR>
turn the messages off.
<BR>
<P>Thoughts?
<BR>
<P>Sean
<BR>
<P><PRE>
-- 
To unsubscribe: send e-mail to axp-list-request@redhat.com with
'unsubscribe' as the subject.  Do not send it to axp-list@redhat.com
</PRE>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0438.html">Jano Lukac: "Re: Unaligned traps et al"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0436.html">Sean Hunter: "Re: kmem_alloc: Bad poison (name=size-256) (fwd)"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0441.html">Richard Henderson: "Re: Unaligned traps et al"</A>
<LI><STRONG>Maybe reply:</STRONG> <A HREF="0426.html">Sean Hunter: "Re: Unaligned traps et al"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.www.fts.frontec.se/~dast/hypermail/">hypermail 2a22</A> 
: <EM>Tue Sep 07 1999 - 16:15:02 PDT</EM>
</EM>
</SMALL>
</BODY>
</HTML>
