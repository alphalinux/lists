<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>axp-list: Re: where does the memory go?</TITLE>
<META NAME="Author" CONTENT="Matt Nelson (mnelson@dynatec.com)">
<META NAME="Subject" CONTENT="Re: where does the memory go?">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: where does the memory go?</H1>
<HR>
<P>
<!-- received="Wed Mar 10 00:12:50 1999 PST" -->
<!-- sent="Tue, 9 Mar 1999 15:32:35 -0800 (PST)" -->
<!-- name="Matt Nelson" -->
<!-- email="mnelson@dynatec.com" -->
<!-- subject="Re: where does the memory go?" -->
<!-- id="Pine.LNX.4.05.9903091531210.18520-100000@gumby.dynatec.com" -->
<!-- inreplyto="Pine.SGI.4.09.9L.9903091622230.11809-100000@helix.nih.gov" -->
<STRONG>Matt Nelson</STRONG> (<A HREF="mailto:mnelson@dynatec.com?subject=Re:%20where%20does%20the%20memory%20go?"><EM>mnelson@dynatec.com</EM></A>)<BR>
<EM>Tue, 9 Mar 1999 15:32:35 -0800 (PST)</EM>
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#505">[ date ]</A>
<A HREF="index.html#505">[ thread ]</A>
<A HREF="subject.html#505">[ subject ]</A>
<A HREF="author.html#505">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0506.html">Maurice Hilarius: "Re: Prices for AlphaLinux systems with 4-8GB RAM ?"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0504.html">Ron Farrer: "Re: Prices for AlphaLinux systems with 4-8GB RAM ?"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0500.html">Greg Lindahl: "Re: Prices for AlphaLinux systems with 4-8GB RAM ?"</A>
<!-- nextthread="start" -->
</UL>
<HR>
<!-- body="start" -->
<P>
glad to see i'm not going crazy.
<BR>
<P>please do post your fragbuster.  i don't have time at the moment to hack
<BR>
one together myself!
<BR>
<P>-matt
<BR>
<P>-----------------------------------------------------------------------------
<BR>
Matthew Nelson
<BR>
Dynamics Technology, Inc. 
<BR>
21311 Hawthorne Blvd., Suite 300, Torrance, CA 90503-5610
<BR>
Voice: (310) 543-5433   FAX: (310) 543-2117   Email: <A HREF="mailto:mnelson@dynatec.com?subject=Re:%20where%20does%20the%20memory%20go?">mnelson@dynatec.com</A>
<BR>
<P>On Tue, 9 Mar 1999, M. Nicklaus wrote:
<BR>
<P><EM>&gt; Matt,
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; On Tue, 9 Mar 1999, Matt Nelson wrote:
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; &gt; On Tue, 9 Mar 1999, Daniel J. Frasnelli wrote:
</EM><BR>
<EM>&gt; &gt; &gt; And let's compare this to my system with 128M ram:
</EM><BR>
<EM>&gt; &gt; &gt; [&gt; &gt; &gt; [dfrasnel@relativity /tmp]$ free
</EM><BR>
<EM>&gt; &gt; &gt;              total       used       free     shared    buffers     cached
</EM><BR>
<EM>&gt; &gt; &gt; Mem:        127312     115416      11896      73936      13832      61216
</EM><BR>
<EM>&gt; &gt; &gt; -/+ buffers/cache:      40368      86944
</EM><BR>
<EM>&gt; &gt; &gt; Swap:       131064        632     130432
</EM><BR>
<EM>&gt; &gt; &gt; 
</EM><BR>
<EM>&gt; &gt; &gt; If you look at both of these 'free' outputs, you will notice that a good 
</EM><BR>
<EM>&gt; &gt; &gt; amount of memory is tied up in both cached and shared memory allocation.
</EM><BR>
<EM>&gt; &gt; &gt; My system shows approx. 11M of physical memory free.  However, if I were to 
</EM><BR>
<EM>&gt; &gt; &gt; launch Netscape 4.51 (memory footprint of what, 30M?) I could do so
</EM><BR>
<EM>&gt; &gt; &gt; without dipping into swap space.  
</EM><BR>
<EM>&gt; &gt; 
</EM><BR>
<EM>&gt; &gt; what you say is true, but i was more concerned with the -/+ buffers/cache
</EM><BR>
<EM>&gt; &gt; line of the free(1) output.  that line, if i understand it correctly,
</EM><BR>
<EM>&gt; &gt; indicates what your are using and have available if you dont count buffers
</EM><BR>
<EM>&gt; &gt; and cache.  in your example, it shows that you have about 40M used and
</EM><BR>
<EM>&gt; &gt; about 87M free.  *those* are the numbers that i'm wondering about.  on my
</EM><BR>
<EM>&gt; &gt; machine, the -/+ buffers/cache used climbs to ~110M during the activity of
</EM><BR>
<EM>&gt; &gt; the day, then drops down to ~25M during the night.
</EM><BR>
<EM>&gt; &gt; 
</EM><BR>
<EM>&gt; &gt; when i compare the 110M to the output of &quot;ps axm&quot; during a quiet time in
</EM><BR>
<EM>&gt; &gt; the day (i.e., no user jobs running), i see that the the total memory used
</EM><BR>
<EM>&gt; &gt; doesn't seem to add up to the 110M that free(1) indicates.  and yes, X has
</EM><BR>
<EM>&gt; &gt; the biggest memory footprint on an idle machine...
</EM><BR>
<EM>&gt; &gt; 
</EM><BR>
<EM>&gt; &gt; at first i thought there was a memory leak somewhere, but when it went
</EM><BR>
<EM>&gt; &gt; back down to something reasonable over night, i figure that i must not be
</EM><BR>
<EM>&gt; &gt; understanding something.
</EM><BR>
<EM>&gt; &gt; 
</EM><BR>
<EM>&gt; &gt; any other ideas? 
</EM><BR>
<EM>&gt; &gt; 
</EM><BR>
<EM>&gt; &gt; -matt
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; We've seen this kind of effect repeatedly on our various Alpha/Linux
</EM><BR>
<EM>&gt; boxes.  Often, as was pointed out, it has no real negative effects.
</EM><BR>
<EM>&gt; But we've definitely had cases where we couldn't start up certain
</EM><BR>
<EM>&gt; applications any more, or could not even telnet into the system any more.
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Often, it seems that network-related processes contribute to this
</EM><BR>
<EM>&gt; behavior, especially if there's a problem with the network, or some faulty
</EM><BR>
<EM>&gt; network setup etc.  We've had cases where a 512 MB machine came up with 
</EM><BR>
<EM>&gt; 4 kB free memory after RPC'ing like crazy during boot-up.
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Without being experts in this, we've attributed this to some kind of
</EM><BR>
<EM>&gt; memory fragmentation caused by processes that may be long dead, and which
</EM><BR>
<EM>&gt; is possibly not cleaned up optimally.  The size of the swap space seems to
</EM><BR>
<EM>&gt; play an important role here:  with swap space smaller than physical
</EM><BR>
<EM>&gt; memory, it appears that the system has more difficulties moving large
</EM><BR>
<EM>&gt; applications (and buffers etc.?) in and out of memory without causing
</EM><BR>
<EM>&gt; memory fragmentation.  After setting swap space to at least physical RAM
</EM><BR>
<EM>&gt; size on all machines, this problem has become much less frequent.
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Be that as it may, we've solved this problem by writing a little &quot;RAM
</EM><BR>
<EM>&gt; scrubber&quot; application that allocates, and actually accesses, progressively
</EM><BR>
<EM>&gt; larger chunks of memory, up to a user-defined limit (it doesn't pay much
</EM><BR>
<EM>&gt; to go all the way into swap space, obviously).  This little program has
</EM><BR>
<EM>&gt; solved the above problems for us in all cases.
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; An example I just ran on one of our Alphas:
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; &quot;before&quot;
</EM><BR>
<EM>&gt;              total       used       free     shared    buffers     cached
</EM><BR>
<EM>&gt; Mem:        515320     506744       8576      14880     383880      13424
</EM><BR>
<EM>&gt; -/+ buffers:           109440     405880
</EM><BR>
<EM>&gt; Swap:       590176        144     590032
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; &quot;after&quot;
</EM><BR>
<EM>&gt;              total       used       free     shared    buffers     cached
</EM><BR>
<EM>&gt; Mem:        515320      12264     503056       5216        208       3184
</EM><BR>
<EM>&gt; -/+ buffers:             8872     506448
</EM><BR>
<EM>&gt; Swap:       590176       1992     588184
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; If there's interest, I can post this program here.
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; (BTW, this effect doesn't seem to be unique to Alpha/Linux.  We've seen it
</EM><BR>
<EM>&gt; on x86/Linux as well as SGI IRIX, albeit to some lesser extent.  In any
</EM><BR>
<EM>&gt; event, we've installed our little &quot;RAM scrubber&quot;, or &quot;fragbuster&quot;,
</EM><BR>
<EM>&gt; program, on *all* our Linux/Unix systems.)
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Hope this was of some use,
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Marc
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; -- 
</EM><BR>
<EM>&gt; To unsubscribe: send e-mail to <A HREF="mailto:axp-list-request@redhat.com?subject=Re:%20where%20does%20the%20memory%20go?">axp-list-request@redhat.com</A> with
</EM><BR>
<EM>&gt; 'unsubscribe' as the subject.  Do not send it to <A HREF="mailto:axp-list@redhat.com?subject=Re:%20where%20does%20the%20memory%20go?">axp-list@redhat.com</A>
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 
</EM><BR>
<P><PRE>
-- 
To unsubscribe: send e-mail to <A HREF="mailto:axp-list-request@redhat.com?subject=Re:%20where%20does%20the%20memory%20go?">axp-list-request@redhat.com</A> with
'unsubscribe' as the subject.  Do not send it to <A HREF="mailto:axp-list@redhat.com?subject=Re:%20where%20does%20the%20memory%20go?">axp-list@redhat.com</A>
</PRE>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0506.html">Maurice Hilarius: "Re: Prices for AlphaLinux systems with 4-8GB RAM ?"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0504.html">Ron Farrer: "Re: Prices for AlphaLinux systems with 4-8GB RAM ?"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0500.html">Greg Lindahl: "Re: Prices for AlphaLinux systems with 4-8GB RAM ?"</A>
<!-- nextthread="start" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.landfield.com/hypermail/">hypermail 2.0b3</A> 
on <EM>Tue Mar 09 1999 - 17:00:18 PST</EM>
</EM>
</SMALL>
</BODY>
</HTML>
