<!-- received="Wed Jun 18 17:27:41 1997 " -->
<!-- sent="Wed, 18 Jun 1997 17:22:36 -0400 (EDT)" -->
<!-- name="Craig Burley" -->
<!-- email="burley@gnu.ai.mit.edu" -->
<!-- subject="Re: join the "Get Craig a Real Machine Campaign"" -->
<!-- id="199706182122.RAA29510@churchy.gnu.ai.mit.edu" -->
<!-- inreplyto="join the "Get Craig a Real Machine Campaign"" -->
<HTML><HEAD><META NAME="htdig-email" CONTENT="webmaster@redhat.com"><TITLE>Re: join the "Get Craig a Real Machine Campaign"</TITLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#ececec"  LINK="#3333cc" VLINK="#666666"><h2>Re: join the "Get Craig a Real Machine Campaign"</h2>

<b>Craig Burley</b> (<a href="mailto:burley@gnu.ai.mit.edu"><i>burley@gnu.ai.mit.edu</i></a>)<br>
<i>Wed, 18 Jun 1997 17:22:36 -0400 (EDT)</i>
<p>
<ul>
<li> <b>Messages sorted by:</b> <a href="date.html#565">[ date ]</a><a href="index.html#565">[ thread ]</a><a href="subject.html#565">[ subject ]</a><a href="author.html#565">[ author ]</a>
<!-- next="start" -->
<li> <b>Next message:</b> <a href="0566.html">Bill Broadley: "Re: "Get Craig a Real Machine" Campaign: status update"</a>
<li> <b>Previous message:</b> <a href="0564.html">Kendrick Vargas: "Re: Problems booting XL-300"</a>
<li> <b>Maybe in reply to:</b> <a href="0521.html">David Mosberger-Tang: "join the "Get Craig a Real Machine Campaign""</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<!-- body="start" -->
I'd like to address some of the points recently brought up here.<br>
<p>
On Wed, 18 Jun 1997, Steve Borho wrote:<br>
<p>
<i>&gt;To tell the truth I'd be willing to throw more money at an individual who</i><br>
<i>&gt;was actively optimizing GCC to run faster on Alpha systems and to produce</i><br>
<i>&gt;executables at least as fast as the DEC compilers.</i><br>
<p>
Ben Scott &lt;<a href="mailto:ben.scott@unh.edu">ben.scott@unh.edu</a>&gt; writes:<br>
<p>
<i>&gt;  I second this opinion.  I'm quite willing to put $50 towards a better</i><br>
<i>&gt;Fortran because it needs to be done, we could use it here where I work, and I</i><br>
<i>&gt;like the Alpha platform.  But we would *really* like a better optimized Alpha</i><br>
<i>&gt;GCC.  If GCC produced really good Alpha code, we'd likely have more Alpha</i><br>
<i>&gt;Linux boxes (or more Alpha boxes in general, at least).  Seeing how the kernel</i><br>
<i>&gt;and most of the system utils are written in C, I think a better GCC would have</i><br>
<i>&gt;a bigger influence then g77, too. </i><br>
<p>
I've been under the impression that some people (or person) _are_<br>
doing such work for gcc on Linux/Alpha, but haven't actively<br>
pursued this.  But, I agree, improving the code-generating<br>
back end of gcc for Alpha targets is highly important, both to<br>
gcc and g77, and all things compiled by them.<br>
<p>
Strictly speaking, the funding being requested here is for a faster<br>
_development platform_ for g77 that will also serve as a good _optimization<br>
target_ for code-generation work.<br>
<p>
So, g77 users are interested in g77 generating faster code.  Fine, I'm<br>
happy to work on that, as I've been all along.  (Though I still spend<br>
almost all my g77 time working on new features, fixing bugs, answering<br>
questions, packaging releases, etc.)<br>
<p>
But, to _do_ my g77 work, I need a faster gcc, a faster gld, a working<br>
gdb, a faster Linux, etc., etc.<br>
<p>
Since I don't actually _program_ in Fortran, I personally have no need for<br>
a highly optimizing g77.  But, I _do_ have a strong desire for ever-faster<br>
software that I do use, and that means a highly optimizing gcc.  Any work<br>
I do improving g77 is likely to be strongly influenced by the goal of<br>
improving gcc as well, for my own personal benefit, though that cannot<br>
always be practically accomplished.<br>
<p>
Further, gcc is _not_ likely to be highly optimized for the Alpha such<br>
that it approaches the kind of performance achieved via Digital Fortran.<br>
The _only_ way I think that might happen is if the target of such<br>
optimizations is Fortran code, vis, g77.  The reasons for this are<br>
fairly technical, involving both the nature of legacy code written in<br>
Fortran vs. C and the differences between the languages (that is,<br>
between what similar-looking code in C vs. Fortran _means_).<br>
<p>
I'll illustrate with a quick example:<br>
<p>
	SUBROUTINE X(A,B,C,N)<br>
	REAL A(N),B(N),C(N)<br>
	DO I=1,N<br>
	   C(I) = A(I)*3.14 + B(I)<br>
	END DO<br>
	END<br>
<p>
(I made this up.  It proves I'm not a real Fortran programmer, anyway.  ;-)<br>
<p>
If you give this code to g77 now, even turning all the optimization<br>
options on, such as loop unrolling, you won't get close to the kinds<br>
of performance you could (or I could, I think) trivially achieve using<br>
explicitly pipelined (prefetching) code.  Just looking at the output g77<br>
currently (0.5.21-in-development) gives for this, using -O6<br>
-funroll-all-loops, I think I could fairly quickly optimize this to<br>
go much faster.  (If you want me to spend some time measuring this<br>
myself, then doing the modifications and measuring the improvements,<br>
I could, but it'd be time I wouldn't spend on g77 itself.  I could<br>
view it as "fundraising" time, and it'd be fun to do, so if it'd help<br>
you make a decision about donations, for example, let me know.)<br>
<p>
The reason gcc is unlikely, on its own, to perform optimizations like<br>
this is that, generally, with 99.99% of all C code in existance that<br>
even _does_ this sort of computation, gcc can't determine a priori<br>
that there are no recurrence relations in the loop.  Specifically, it<br>
cannot assume that it can prefetch A(2), B(2), A(3), B(3), and so on<br>
_before_ it writes C(1), because C(1) might have the same address as,<br>
say, B(2).  That kind of aliasing is invalid in Fortran, and supercomputers<br>
(even the minisupercomputer 128-bit VLIW machine I used to do assembly<br>
coding and Fortran compiler optimization development work) _depend_<br>
on there being no such aliasing.  So, there's no module in gcc (probably<br>
not even in 2.8.0, still in development) that does the kind of<br>
stuff I'm talking about, though I think there should be.<br>
<p>
Even when there are explicit recurrence relations in a loop, I can't<br>
believe (and wouldn't suggest anyone expect) _gcc_ people to care about<br>
optimizing some of them appropriately, e.g.:<br>
<p>
	FUNCTION SUM(A,B,N)<br>
	REAL A(N),B(N)<br>
	SUM=0.<br>
	DO I=1,N<br>
	   SUM = SUM + A(I)**2 + 3*B(I)<br>
	END DO<br>
	END<br>
<p>
Here, the generated code can't prefetch in the "usual" way in its<br>
unrolled loop, because the value SUM starts with in iteration I would<br>
not be the same value it'd have written in iteration I-1, which<br>
the code clearly requires.<br>
<p>
Fortunately, the compiler (whether gcc or g77) could see this and,<br>
in this case, could reason that, since the recurrence operation (dunno<br>
if that's the right term here) is `+', is commutative and such, it<br>
can safely convert the above to:<br>
<p>
	FUNCTION SUM(A,B,N)<br>
	REAL A(N),B(N)<br>
	REAL TSUM(0:3)<br>
	TSUM(0)=0.<br>
	TSUM(1)=0.<br>
	TSUM(2)=0.<br>
	TSUM(3)=0.<br>
	DO I=1,N<br>
	   MOD = MOD(I,4)<br>
	   TSUM(MOD) = TSUM(MOD) + A(I)**2 + 3*B(I)<br>
	END DO<br>
	SUM = TSUM(0) + TSUM(1) + TSUM(2) + TSUM(3)<br>
	END<br>
<p>
I'm pretty sure that, once the compiler knew it could perform the<br>
above transformation, the resulting code would exhibit _much_<br>
better performance on a machine like an Alpha (though maybe only<br>
some of the chips, e.g., maybe not a real early one with a limited<br>
memory subsystem).<br>
<p>
In summary, I just don't see how people working on optimizing gcc for<br>
the Alpha are going to do this stuff on their own.  To almost everyone<br>
working on optimizing other languages, stuff like the above is "exotic".<br>
To the Fortran community, which properly includes anyone doing stuff<br>
like FFTs (acoustical analysis, e.g. being able to sing into a mic and<br>
have your computer dynamically put up musical notes, show whether you're<br>
off pitch, etc.), stuff like the above is bread-and-butter optimization<br>
on most modern machines, which have fillable pipeline latencies between<br>
loads and uses, etc.  (Heck, gcc _today_ is not even close to the<br>
having the kinds of sophisticated optimizations that were bread-and-butter<br>
in the 128-bit VLIW Fortran compiler I worked on over 10 years ago.<br>
But today's RISC machines are getting to be more VLIW like, when<br>
you factor in the goal of generating optimal code, even though they're<br>
still comparatively easier to compile and program for.)<br>
<p>
A more-general comment on the above, and the subsequent, issue appears<br>
at the bottom of this e-mail.<br>
<p>
"D. Steven Daniel" &lt;<a href="mailto:danields@com230.ee.utk.edu">danields@com230.ee.utk.edu</a>&gt; writes:<br>
<p>
<i>&gt;Is there any reason why work is being done on g77 as opposed to creating a</i><br>
<i>&gt;free FORTRAN 90 compiler? </i><br>
<p>
There are a variety of reasons.  Rather than go into a lot of detail, here's<br>
the summary version:<br>
<p>
  -  Fortran 90 is much harder to do than FORTRAN 77.<br>
<p>
  -  Tons more legacy code written in FORTRAN 77.  (Basically calculate all the<br>
     existing in-production code in all the languages out there, and you've<br>
     got two giants: FORTRAN 77 and COBOL.  At least, last I remember these<br>
     things being measured, all the other languages had small code bases by<br>
     comparison.)<br>
<p>
  -  While developing g77, I started doing F90 instead, and when I realized<br>
     how much longer it'd take, I asked the comp.lang.fortran community.<br>
     The answer was clear: get FORTRAN 77 working well, then move on.<br>
<p>
  -  GNU back end technology is much better suited to FORTRAN 77 than to<br>
     Fortran 90.  So, Fortran 90 with the kind of performance people would<br>
     expect from GNU code-generation technology would require not just<br>
     writing the front end and libraries, but I believe it would require<br>
     rewriting the back end (and maybe even the linker) as well.<br>
<p>
<p>
Funding a single g77 development machine is not going to, by itself, make<br>
all this happen.  The reason is simply that I can't do it all by myself.<br>
<p>
(Well, I do have some strong urges to implement at least a few of the<br>
optimizations that would benefit Fortran plus, say, a C language with<br>
the `restrict' keyword.  And, of course, I'd love to get to the point where<br>
I can feel comfortable, priority-wise, improving gcc on the Alpha generally,<br>
since that makes _my_ development environment faster.  But Fortran 90 all<br>
by myself is Highly Unlikely.)<br>
<p>
But, the funding of a single g77 development machine _will_ get the kind<br>
of attention that, for example, DEC Alphas got when Linus Torvalds ended<br>
up with one.  How much of Linux/Alpha porting work was actually done by<br>
Linus himself?  I'd guess, not a huge percentage at this point -- but<br>
how much of it would have been done in the same tiemframe without that seed<br>
funding?<br>
<p>
In essence, Fortran-friendly optimizations and GNU Fortran 90/95 _might_<br>
happen without any seed funding for "lesser" projects like a better/faster<br>
g77 for Linux/Alpha, but it's hard to see how.  Whereas, the experience<br>
we're seeing here would appear to have the potential to serve notice to<br>
the Fortran community, at least, that the Linux/Alpha community cares<br>
enough about Fortran performance on a free-software-based system to have<br>
funded a serious development machine in _very_ short order using<br>
grass-roots fund-raising techniques.  I think this will get the attention<br>
of the Fortran community.  Once that happens, I think we're well on the<br>
road to funding not only the kinds of optimizations that benefit Fortran<br>
and new compilers like Fortran 90/95, but a much wider breadth of<br>
free-software productds and improvements that benefit all Alpha users<br>
(and, due to expected portability, users of other machines as well,<br>
but we all know how important it is to be Target #1 of product<br>
development, eh?).<br>
<p>
Finally, as I think my .plan file explains somewhat, my personal interest<br>
in continuing to work on g77 is strongly influenced by concrete<br>
funding, and the directions I take in improving it are similarly<br>
influenced.  (Though, long-suffering g77 alpha-testers, having really<br>
made g77 "happen" more than I could single-handedly, do tend to get<br>
their requests moved to the top of the list -- I consider their<br>
investments of significant personal time testing g77 as substantially<br>
concrete funding.)<br>
<p>
Hope this feedback is useful!  Even though it looks very likely that<br>
David's funding target will be met, I hope the info above gives people<br>
some ideas about just how valuable their contributions are, however<br>
"small" they consider them at the time.<br>
<p>
        tq vm, (burley)<br>
<p>
<pre>
--
To unsubscribe: send e-mail to <a href="mailto:axp-list-request@redhat.com">axp-list-request@redhat.com</a> with
'unsubscribe' as the subject.  Do not send it to <a href="mailto:axp-list@redhat.com">axp-list@redhat.com</a>
</pre>
<!-- body="end" -->
<p>
<ul>
<!-- next="start" -->
<li> <b>Next message:</b> <a href="0566.html">Bill Broadley: "Re: "Get Craig a Real Machine" Campaign: status update"</a>
<li> <b>Previous message:</b> <a href="0564.html">Kendrick Vargas: "Re: Problems booting XL-300"</a>
<li> <b>Maybe in reply to:</b> <a href="0521.html">David Mosberger-Tang: "join the "Get Craig a Real Machine Campaign""</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<br clear=all>
<hr>
<center>
<a href="mailto:webmaster@redhat.com"   target="">Feedback</a> | 
<a href="http://www.redhat.com/products/"   target="">Store</a> | 
<a href="http://www.redhat.com/news/"   target="">News</a> | 
<a href="http://www.redhat.com/support/"   target="">Support</a> | 
<a href="http://www.redhat.com/support/docs/errata.html"   target="">Product Errata</a> | 
<a href="http://www.redhat.com/redhat/"   target="">About Us</a> | 
<a href="http://www.redhat.com/linux-info/"   target="">Linux Info</a> | 
<a href="http://www.redhat.com/search/"   target="">Search</a> | 
<a href="http://www.redhat.com/jumplist.phtml"   target="">JumpWords</a>
<br>
<a href="http://www.redhat.com/cgi-bin/frames.phtml?fr=n"  _top target="_top">No Frames</a> | 
<a href="http://www.redhat.com/cgi-bin/frames.phtml?fr=y"  _top target="_top">Show Frames</a>
</center>
<p align=center>
Copyright &copy; 1995-1997 Red Hat Software. <a href="http://www.redhat.com/redhat/website.html#legal"   target="">Legal notices</a>
</p>
</BODY></HTML>
