<!-- received="Thu Mar 27 19:03:14 1997 " -->
<!-- sent="Thu, 27 Mar 1997 23:58:30 +0000 (GMT)" -->
<!-- name="Philip Blundell" -->
<!-- email="phil@tazenda.demon.co.uk" -->
<!-- subject="2.1.30" -->
<!-- id="3.0.1.32.19970327163825.006d28cc@ellpspace.math.ualberta.ca" -->
<!-- inreplyto="ео	@ео	@requ" -->
<HTML><HEAD><META NAME="htdig-email" CONTENT="webmaster@redhat.com"><TITLE>2.1.30</TITLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#ececec"  LINK="#3333cc" VLINK="#666666"><h2>2.1.30</h2>

<b>Philip Blundell</b> (<a href="mailto:phil@tazenda.demon.co.uk"><i>phil@tazenda.demon.co.uk</i></a>)<br>
<i>Thu, 27 Mar 1997 23:58:30 +0000 (GMT)</i>
<p>
<ul>
<li> <b>Messages sorted by:</b> <a href="date.html#785">[ date ]</a><a href="index.html#785">[ thread ]</a><a href="subject.html#785">[ subject ]</a><a href="author.html#785">[ author ]</a>
<!-- next="start" -->
<li> <b>Next message:</b> <a href="0786.html">Matthew Geier: "Re: 2.1.30"</a>
<li> <b>Previous message:</b> <a href="0784.html">Maurice W. Hilarius: "Re: WANTED:  testers for audio program"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<!-- body="start" -->
Here are some patches I made to get 2.1.30 to compile on the Alpha.  I<br>
hope they're broadly right.<br>
<p>
I'm finding that gcc aborts when it tries to compile slip.o.  I presume<br>
this is a gcc bug - is there a fix?<br>
<p>
phil<br>
<p>
diff -u -r1.1.1.1 smp_lock.h<br>
--- linux/include/asm-alpha/smp_lock.h	1997/03/21 17:39:42	1.1.1.1<br>
+++ linux/include/asm-alpha/smp_lock.h	1997/03/27 21:01:07<br>
@@ -5,6 +5,8 @@<br>
 <br>
 #define lock_kernel()		do { } while(0)<br>
 #define unlock_kernel()		do { } while(0)<br>
+#define release_kernel_lock(task, cpu, depth)  ((depth) = 1)<br>
+#define reaquire_kernel_lock(task, cpu, depth) do {} while (0)<br>
 <br>
 #else<br>
 <br>
diff -u -r1.1.1.1 system.h<br>
--- linux/include/asm-alpha/system.h	1997/03/21 17:39:41	1.1.1.1<br>
+++ linux/include/asm-alpha/system.h	1997/03/27 22:25:48<br>
@@ -97,10 +97,15 @@<br>
 	: "$0", "$1", "$16", "$22", "$23", "$24", "$25", "memory"); \<br>
 __old_ipl; })<br>
 <br>
-#define cli()			setipl(7)<br>
-#define sti()			setipl(0)<br>
-#define save_flags(flags)	do { flags = getipl(); } while (0)<br>
-#define restore_flags(flags)	setipl(flags)<br>
+#define __cli()			setipl(7)<br>
+#define __sti()			setipl(0)<br>
+#define __save_flags(flags)	do { flags = getipl(); } while (0)<br>
+#define __restore_flags(flags)	setipl(flags)<br>
+<br>
+#define cli()			__cli()<br>
+#define sti()			__sti()<br>
+#define save_flags(flags)	__save_flags(flags)<br>
+#define restore_flags(flags)	__restore_flags(flags)<br>
 <br>
 /*<br>
  * TB routines..<br>
diff -u -r1.1.1.1 termios.h<br>
--- linux/include/asm-alpha/termios.h	1997/03/21 17:39:42	1.1.1.1<br>
+++ linux/include/asm-alpha/termios.h	1997/03/27 21:33:24<br>
@@ -92,22 +92,13 @@<br>
 }<br>
 <br>
 #define user_termio_to_kernel_termios(termios, termio) \<br>
-do { \<br>
+({ \<br>
 	SET_LOW_TERMIOS_BITS(termios, termio, c_iflag); \<br>
 	SET_LOW_TERMIOS_BITS(termios, termio, c_oflag); \<br>
 	SET_LOW_TERMIOS_BITS(termios, termio, c_cflag); \<br>
 	SET_LOW_TERMIOS_BITS(termios, termio, c_lflag); \<br>
-	get_user((termios)-&gt;c_cc[VINTR], &amp;(termio)-&gt;c_cc[_VINTR]); \<br>
-	get_user((termios)-&gt;c_cc[VQUIT], &amp;(termio)-&gt;c_cc[_VQUIT]); \<br>
-	get_user((termios)-&gt;c_cc[VERASE], &amp;(termio)-&gt;c_cc[_VERASE]); \<br>
-	get_user((termios)-&gt;c_cc[VKILL], &amp;(termio)-&gt;c_cc[_VKILL]); \<br>
-	get_user((termios)-&gt;c_cc[VEOF], &amp;(termio)-&gt;c_cc[_VEOF]); \<br>
-	get_user((termios)-&gt;c_cc[VMIN], &amp;(termio)-&gt;c_cc[_VMIN]); \<br>
-	get_user((termios)-&gt;c_cc[VEOL], &amp;(termio)-&gt;c_cc[_VEOL]); \<br>
-	get_user((termios)-&gt;c_cc[VTIME], &amp;(termio)-&gt;c_cc[_VTIME]); \<br>
-	get_user((termios)-&gt;c_cc[VEOL2], &amp;(termio)-&gt;c_cc[_VEOL2]); \<br>
-	get_user((termios)-&gt;c_cc[VSWTC], &amp;(termio)-&gt;c_cc[_VSWTC]); \<br>
-} while(0)<br>
+	copy_from_user((termios)-&gt;c_cc, (termio)-&gt;c_cc, NCC); \<br>
+})<br>
 <br>
 /*<br>
  * Translate a "termios" structure into a "termio". Ugh.<br>
@@ -115,25 +106,14 @@<br>
  * Note the "fun" _VMIN overloading.<br>
  */<br>
 #define kernel_termios_to_user_termio(termio, termios) \<br>
-do { \<br>
+({ \<br>
 	put_user((termios)-&gt;c_iflag, &amp;(termio)-&gt;c_iflag); \<br>
 	put_user((termios)-&gt;c_oflag, &amp;(termio)-&gt;c_oflag); \<br>
 	put_user((termios)-&gt;c_cflag, &amp;(termio)-&gt;c_cflag); \<br>
 	put_user((termios)-&gt;c_lflag, &amp;(termio)-&gt;c_lflag); \<br>
 	put_user((termios)-&gt;c_line, &amp;(termio)-&gt;c_line); \<br>
-	put_user((termios)-&gt;c_cc[VINTR], &amp;(termio)-&gt;c_cc[_VINTR]); \<br>
-	put_user((termios)-&gt;c_cc[VQUIT], &amp;(termio)-&gt;c_cc[_VQUIT]); \<br>
-	put_user((termios)-&gt;c_cc[VERASE], &amp;(termio)-&gt;c_cc[_VERASE]); \<br>
-	put_user((termios)-&gt;c_cc[VKILL], &amp;(termio)-&gt;c_cc[_VKILL]); \<br>
-	put_user((termios)-&gt;c_cc[VEOF], &amp;(termio)-&gt;c_cc[_VEOF]); \<br>
-	put_user((termios)-&gt;c_cc[VEOL], &amp;(termio)-&gt;c_cc[_VEOL]); \<br>
-	put_user((termios)-&gt;c_cc[VEOL2], &amp;(termio)-&gt;c_cc[_VEOL2]); \<br>
-	put_user((termios)-&gt;c_cc[VSWTC], &amp;(termio)-&gt;c_cc[_VSWTC]); \<br>
-	if (!((termios)-&gt;c_lflag &amp; ICANON)) { \<br>
-		put_user((termios)-&gt;c_cc[VMIN], &amp;(termio)-&gt;c_cc[_VMIN]); \<br>
-		put_user((termios)-&gt;c_cc[VTIME], &amp;(termio)-&gt;c_cc[_VTIME]); \<br>
-	} \<br>
-} while(0)<br>
+	copy_to_user((termios)-&gt;c_cc, (termio)-&gt;c_cc, NCC); \<br>
+})<br>
 <br>
 #define user_termios_to_kernel_termios(k, u) copy_from_user(k, u, sizeof(struct termios))<br>
 #define kernel_termios_to_user_termios(u, k) copy_to_user(u, k, sizeof(struct termios))<br>
--- /dev/null	Tue Jan  1 04:00:00 1980<br>
+++ linux/include/asm-alpha/hardirq.h	Thu Mar 27 21:34:42 1997<br>
@@ -0,0 +1,21 @@<br>
+#ifndef __ASM_HARDIRQ_H<br>
+#define __ASM_HARDIRQ_H<br>
+<br>
+extern unsigned int local_irq_count[NR_CPUS];<br>
+#define in_interrupt()	(local_irq_count[smp_processor_id()] != 0)<br>
+<br>
+#ifndef __SMP__<br>
+<br>
+#define hardirq_trylock(cpu)	((cpu)==0)	/* always true */<br>
+#define hardirq_endlock(cpu)	do { } while (0)<br>
+<br>
+#define hardirq_enter(cpu)	(local_irq_count[cpu]++)<br>
+#define hardirq_exit(cpu)	(local_irq_count[cpu]--)<br>
+<br>
+#else<br>
+<br>
+#error No SMP on Alpha.<br>
+<br>
+#endif /* __SMP__ */<br>
+<br>
+#endif /* __ASM_HARDIRQ_H */<br>
--- /dev/null	Tue Jan  1 04:00:00 1980<br>
+++ linux/include/asm-alpha/softirq.h	Thu Mar 27 23:32:01 1997<br>
@@ -0,0 +1,23 @@<br>
+#ifndef __ASM_SOFTIRQ_H<br>
+#define __ASM_SOFTIRQ_H<br>
+<br>
+/*<br>
+ * Software interrupts..<br>
+ */<br>
+#define get_active_bhs()	(bh_mask &amp; bh_active)<br>
+#define clear_active_bhs(x)	(bh_active &amp;= x)<br>
+<br>
+#ifdef __SMP__<br>
+<br>
+#error No SMP on Alpha.<br>
+<br>
+#else<br>
+<br>
+/* These are for the irq's testing the lock */<br>
+#define softirq_trylock()	(intr_count ? 0 : ((intr_count=1),1))<br>
+#define softirq_endlock()	(intr_count = 0)<br>
+<br>
+<br>
+#endif<br>
+<br>
+#endif<br>
--- /dev/null	Tue Jan  1 04:00:00 1980<br>
+++ linux/include/asm-alpha/spinlock.h	Thu Mar 27 23:56:11 1997<br>
@@ -0,0 +1,26 @@<br>
+#ifndef __ASM_SPINLOCK_H<br>
+#define __ASM_SPINLOCK_H<br>
+<br>
+#ifndef __SMP__<br>
+<br>
+typedef struct { } spinlock_t;<br>
+#define SPIN_LOCK_UNLOCKED { }<br>
+<br>
+#define spin_lock_init(lock)	do { } while(0)<br>
+#define spin_lock(lock)		do { } while(0)<br>
+#define spin_trylock(lock)	do { } while(0)<br>
+#define spin_unlock(lock)	do { } while(0)<br>
+#define spin_lock_irq(lock)	cli()<br>
+#define spin_unlock_irq(lock)	sti()<br>
+<br>
+#define spin_lock_irqsave(lock, flags) \<br>
+	do { save_flags(flags); cli(); } while (0)<br>
+#define spin_unlock_irqrestore(lock, flags) \<br>
+	restore_flags(flags)<br>
+<br>
+#else<br>
+<br>
+#error _Still_ no SMP on Alpha. :-)<br>
+<br>
+#endif /* SMP */<br>
+#endif /* __ASM_SPINLOCK_H */<br>
<p>
<p>
<pre>
--
To unsubscribe: send e-mail to <a href="mailto:axp-list-request@redhat.com">axp-list-request@redhat.com</a> with
'unsubscribe' as the subject.  Do not send it to <a href="mailto:axp-list@redhat.com">axp-list@redhat.com</a>
</pre>
<!-- body="end" -->
<p>
<ul>
<!-- next="start" -->
<li> <b>Next message:</b> <a href="0786.html">Matthew Geier: "Re: 2.1.30"</a>
<li> <b>Previous message:</b> <a href="0784.html">Maurice W. Hilarius: "Re: WANTED:  testers for audio program"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<br clear=all>
<hr>
<center>
<a href="mailto:webmaster@redhat.com"   target="">Feedback</a> | 
<a href="http://www.redhat.com/products/"   target="">Store</a> | 
<a href="http://www.redhat.com/news/"   target="">News</a> | 
<a href="http://www.redhat.com/support/"   target="">Support</a> | 
<a href="http://www.redhat.com/support/docs/errata.html"   target="">Product Errata</a> | 
<a href="http://www.redhat.com/redhat/"   target="">About Us</a> | 
<a href="http://www.redhat.com/linux-info/"   target="">Linux Info</a> | 
<a href="http://www.redhat.com/search/"   target="">Search</a> | 
<a href="http://www.redhat.com/jumplist.phtml"   target="">JumpWords</a>
<br>
<a href="http://www.redhat.com/cgi-bin/frames.phtml?fr=n"  _top target="_top">No Frames</a> | 
<a href="http://www.redhat.com/cgi-bin/frames.phtml?fr=y"  _top target="_top">Show Frames</a>
</center>
<p align=center>
Copyright &copy; 1995-1997 Red Hat Software. <a href="http://www.redhat.com/redhat/website.html#legal"   target="">Legal notices</a>
</p>
</BODY></HTML>
