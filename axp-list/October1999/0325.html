<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1252">
<TITLE>axp-list: RE: PATCH: (on Alpha) emulating missing instructions</TITLE>
<META NAME="Author" CONTENT="Lennart Börjeson (LennartB@cinnober.com)">
<META NAME="Subject" CONTENT="RE: PATCH: (on Alpha) emulating missing instructions">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>RE: PATCH: (on Alpha) emulating missing instructions</H1>
<HR>
<P>
<!-- received="Fri Oct 15 17:10:46 1999" -->
<!-- isoreceived="19991016001046" -->
<!-- sent="Fri, 15 Oct 1999 12:03:03 +0200" -->
<!-- isosent="19991015100303" -->
<!-- name="Lennart Börjeson" -->
<!-- email="LennartB@cinnober.com" -->
<!-- subject="RE: PATCH: (on Alpha) emulating missing instructions" -->
<!-- id="E536C8EE2A1FD31195370008C79FFA1F040DB5@world.cinnober.com" -->
<!-- charset="windows-1252" -->
<!-- inreplyto="PATCH: (on Alpha) emulating missing instructions" -->
<STRONG>Subject: </STRONG>RE: PATCH: (on Alpha) emulating missing instructions<BR>
<STRONG>From: </STRONG>Lennart Börjeson (<EM>LennartB@cinnober.com</EM>)<BR>
<STRONG>Date: </STRONG>Fri Oct 15 1999 - 03:03:03 PDT
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#325">[ date ]</A>
<A HREF="index.html#325">[ thread ]</A>
<A HREF="subject.html#325">[ subject ]</A>
<A HREF="author.html#325">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0326.html">Daniel Potts: "RE: PATCH: (on Alpha) emulating missing instructions"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0324.html">Luke Deller: "PATCH: (on Alpha) emulating missing instructions"</A>
<LI><STRONG>Maybe in reply to:</STRONG> <A HREF="0327.html">Eric Bohm: "PATCH: (on Alpha) emulating missing instructions"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0326.html">Daniel Potts: "RE: PATCH: (on Alpha) emulating missing instructions"</A>
<LI><STRONG>Maybe reply:</STRONG> <A HREF="0327.html">Lennart Börjeson: "RE: PATCH: (on Alpha) emulating missing instructions"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Eminently done, but I was really under the impression that these exceptions
<BR>
should be handled by the PALcode (since it is really a general Alpha
<BR>
problem, not Linux-specific)? Is this not so (i.e. are we missing some
<BR>
PALcode update) or is it solved differently in different OSes?
<BR>
<P>-----Original Message-----
<BR>
From: Luke Deller [mailto:luked@cse.unsw.edu.au]
<BR>
Sent: Friday, October 15, 1999 11:39 AM
<BR>
To: axp-list@redhat.com
<BR>
Cc: axp-list@redhat.com; Daniel Paul Potts
<BR>
Subject: PATCH: (on Alpha) emulating missing instructions
<BR>
<P><P>Daniel &amp; I tried to run Loki's new beta version of Civilization Call to
<BR>
Power for alpha linux on a multia (ev4 alpha).  We got an illegal
<BR>
instruction exception.  We discovered that it was compiled for ev6, and so
<BR>
contained instructions not supported by our CPU.
<BR>
<P>So we have patched the linux kernel to emulate the instructions we needed.
<BR>
These instructions are:
<BR>
- byte/word load/store instructions (ldbu,stb,ldwu,stw)
<BR>
- some multimedia instructions (minsw, maxsw, minuw, maxuw, minsb, maxsb,
<BR>
&nbsp;&nbsp;minub, maxub)
<BR>
<P>We have tried to make the emulation fairly fast - we have added it as some
<BR>
assembly language code to the &quot;illegal instruction exception&quot; kernel entry
<BR>
point in arch/alpha/kernel/entry.S:entIF.  (Of course it's still faster
<BR>
to avoid emulation and use a binary compiled for your generation of alpha
<BR>
cpu).
<BR>
<P>We put an option for enabling it in the &quot;Kernel Hacking&quot; section of the
<BR>
configuration.
<BR>
<P>The patch is applied to kernel version 2.2.11
<BR>
(Loki say not to use 2.2.12 for Civilization CTP) 
<BR>
<P>We only wrote enough emulation code to get CivilizationCTP to run ..  in the
<BR>
future it would be cool to see emulation of a more complete set of
<BR>
instructions in the kernel.
<BR>
<P>Hope this is useful to somebody,
<BR>
<P>Luke Deller &amp; Daniel Potts.
<BR>
<P>--------------------------------------------------------------------------
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Luke Deller                               luked@cse.unsw.edu.au
<BR>
&nbsp;_--_|\    Computer Engineering student           
<BR>
/      \   School of Computer Science and Engineering     ? ? ? ?        
<BR>
\_.--._*   The University of New South Wales               ~~^^~  
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v    Sydney, NSW     2052    AUSTRALIA                o o
<BR>
-------------------------------------------------------ooO--(_)--Ooo------
<BR>
<P><PRE>
-- 
To unsubscribe: send e-mail to axp-list-request@redhat.com with
'unsubscribe' as the subject.  Do not send it to axp-list@redhat.com
</PRE>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0326.html">Daniel Potts: "RE: PATCH: (on Alpha) emulating missing instructions"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0324.html">Luke Deller: "PATCH: (on Alpha) emulating missing instructions"</A>
<LI><STRONG>Maybe in reply to:</STRONG> <A HREF="0327.html">Eric Bohm: "PATCH: (on Alpha) emulating missing instructions"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0326.html">Daniel Potts: "RE: PATCH: (on Alpha) emulating missing instructions"</A>
<LI><STRONG>Maybe reply:</STRONG> <A HREF="0327.html">Lennart Börjeson: "RE: PATCH: (on Alpha) emulating missing instructions"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.www.fts.frontec.se/~dast/hypermail/">hypermail 2a22</A> 
: <EM>Thu Nov 04 1999 - 16:56:51 PST</EM>
</EM>
</SMALL>
</BODY>
</HTML>
