<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>Linux Alpha List: Re: wh64 (slow)</TITLE>
<META NAME="Author" CONTENT="Andrea Arcangeli (andrea@suse.de)">
<META NAME="Subject" CONTENT="Re: wh64 (slow)">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: wh64 (slow)</H1>
<HR>
<P>
<!-- received="Tue Feb 29 18:08:07 2000" -->
<!-- isoreceived="20000301020807" -->
<!-- sent="Mon, 28 Feb 2000 15:26:14 +0100 (CET)" -->
<!-- isosent="20000228142614" -->
<!-- name="Andrea Arcangeli" -->
<!-- email="andrea@suse.de" -->
<!-- subject="Re: wh64 (slow)" -->
<!-- id="Pine.LNX.4.21.0002281418390.455-100000@alpha.random" -->
<!-- inreplyto="20000228004045.A19279@twiddle.net" -->
<STRONG>Subject: </STRONG>Re: wh64 (slow)<BR>
<STRONG>From: </STRONG>Andrea Arcangeli (<EM>andrea@suse.de</EM>)<BR>
<STRONG>Date: </STRONG>Mon Feb 28 2000 - 06:26:14 PST
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#173">[ date ]</A>
<A HREF="index.html#173">[ thread ]</A>
<A HREF="subject.html#173">[ subject ]</A>
<A HREF="author.html#173">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0174.html">Roman Zippel: "Re: new IRQ scalability changes in 2.3.48"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0172.html">Richard Henderson: "Re: wh64 (slow)"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0172.html">Richard Henderson: "Re: wh64 (slow)"</A>
<!-- nextthread="start" -->
<LI><STRONG>Reply:</STRONG> <A HREF="0172.html">Andrea Arcangeli: "Re: wh64 (slow)"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
On Mon, 28 Feb 2000, Richard Henderson wrote:
<BR>
<P><EM>&gt;  { &quot;wh64&quot;,             MFC(0x18,0xF800), BASE, { ZA, PRB } },  /* ev56 una */
</EM><BR>
<P><P>I would assemble the opcode myself with .byte 0xxx if the opcodes wouldn't
<BR>
had to change in function of the register used as parameter. Binding a
<BR>
variable to a register wouldn't been a big deal but I preferred to allow
<BR>
the compiler to choose the best.
<BR>
<P>There's a missing &quot;ZA,&quot; in my sources:
<BR>
<P>&nbsp;&nbsp;{ &quot;wh64&quot;,		MFC(0x18,0xF800), BASE, { PRB } },	/* ev56 una */
<BR>
<P>these are the generated opcodes by my current gas:
<BR>
<P>&nbsp;&nbsp;&nbsp;1200005f8:   00 f8 01 60     wh64    (t0)
<BR>
<P>00 f8 is certainly right. The opcode (first 6byte of the quad word) is ok
<BR>
too. Rb is ok too.
<BR>
<P>Ra is set to zero. Shouldn't it be set to 31 to indicate it's unused? I'll
<BR>
hack it to 31 by hand, now it's so:
<BR>
<P>&nbsp;&nbsp;&nbsp;1200005f8:   00 f8 e1 63     wh64    (t0)
<BR>
<P>Hmm it seems to run faster now:
<BR>
<P>original 7602735, wh64 7605827 diff -3092, other 7543752 diff 58983
<BR>
<P>Not faster than the original though.
<BR>
<P>Now I did the change you pointed out to gas and now the binary gets
<BR>
compiled as I hacked it 8))
<BR>
<P>&nbsp;&nbsp;&nbsp;1200005f8:   00 f8 e1 63     wh64    (t0)
<BR>
<P>So yes Ra has definitely to be set to 31 not to zero ;).
<BR>
<P>But the numbers keep to be lower than before (another run):
<BR>
<P>original 7664299, wh64 7666746 diff -2447, other 7616947 diff 47352
<BR>
<P>Maybe we should run the wh64 some cycles before start writing to memory?
<BR>
<P>Note that my assembly version of clear_page runs faster than the original
<BR>
one though.
<BR>
<P>This is the patch for binutils that fixes the bug:
<BR>
<P>--- binutils-2.9.1.0.25/opcodes/alpha-opc.c.~1~	Wed Mar  4 16:31:48 1998
<BR>
+++ binutils-2.9.1.0.25/opcodes/alpha-opc.c	Mon Feb 28 15:20:26 2000
<BR>
@@ -1012,7 +1012,7 @@
<BR>
&nbsp;&nbsp;&nbsp;{ &quot;rc&quot;,		MFC(0x18,0xE000), BASE, { RA } },
<BR>
&nbsp;&nbsp;&nbsp;{ &quot;ecb&quot;,		MFC(0x18,0xE800), BASE, { PRB } },	/* ev56 una */
<BR>
&nbsp;&nbsp;&nbsp;{ &quot;rs&quot;,		MFC(0x18,0xF000), BASE, { RA } },
<BR>
-  { &quot;wh64&quot;,		MFC(0x18,0xF800), BASE, { PRB } },	/* ev56 una */
<BR>
+  { &quot;wh64&quot;,		MFC(0x18,0xF800), BASE, { ZA, PRB } },	/* ev56 una */
<BR>
&nbsp;
<BR>
&nbsp;&nbsp;&nbsp;{ &quot;hw_mfpr&quot;,		OPR(0x19,0x00), EV4, { RA, RBA, EV4EXTHWINDEX } },
<BR>
&nbsp;&nbsp;&nbsp;{ &quot;hw_mfpr&quot;,		OP(0x19), OP_MASK, EV5, { RA, RBA, EV5HWINDEX } },
<BR>
<P>Andrea
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0174.html">Roman Zippel: "Re: new IRQ scalability changes in 2.3.48"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0172.html">Richard Henderson: "Re: wh64 (slow)"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0172.html">Richard Henderson: "Re: wh64 (slow)"</A>
<!-- nextthread="start" -->
<LI><STRONG>Reply:</STRONG> <A HREF="0172.html">Andrea Arcangeli: "Re: wh64 (slow)"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.www.fts.frontec.se/~dast/hypermail/">hypermail 2a22</A> 
: <EM>Wed Mar 01 2000 - 06:26:28 PST</EM>
</EM>
</SMALL>
</BODY>
</HTML>
