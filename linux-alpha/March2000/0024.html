<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>Linux Alpha List: Re: new IRQ scalability changes in 2.3.48</TITLE>
<META NAME="Author" CONTENT="Andrea Arcangeli (andrea@suse.de)">
<META NAME="Subject" CONTENT="Re: new IRQ scalability changes in 2.3.48">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: new IRQ scalability changes in 2.3.48</H1>
<HR>
<P>
<!-- received="Thu Mar 09 04:21:15 2000" -->
<!-- isoreceived="20000309122115" -->
<!-- sent="Thu, 9 Mar 2000 03:32:55 +0100 (CET)" -->
<!-- isosent="20000309023255" -->
<!-- name="Andrea Arcangeli" -->
<!-- email="andrea@suse.de" -->
<!-- subject="Re: new IRQ scalability changes in 2.3.48" -->
<!-- id="Pine.LNX.4.21.0003090320310.4457-100000@alpha.random" -->
<!-- inreplyto="20000308180226.A26513@hq.fsmlabs.com" -->
<STRONG>Subject: </STRONG>Re: new IRQ scalability changes in 2.3.48<BR>
<STRONG>From: </STRONG>Andrea Arcangeli (<EM>andrea@suse.de</EM>)<BR>
<STRONG>Date: </STRONG>Wed Mar 08 2000 - 18:32:55 PST
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#24">[ date ]</A>
<A HREF="index.html#24">[ thread ]</A>
<A HREF="subject.html#24">[ subject ]</A>
<A HREF="author.html#24">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0025.html">Andrea Arcangeli: "Re: new IRQ scalability changes in 2.3.48"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0023.html">Linus Torvalds: "Re: new IRQ scalability changes in 2.3.48"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0021.html">yodaiken@fsmlabs.com: "Re: new IRQ scalability changes in 2.3.48"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0012.html">Ingo Molnar: "Re: new IRQ scalability changes in 2.3.48"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0021.html">Andrea Arcangeli: "Re: new IRQ scalability changes in 2.3.48"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
On Wed, 8 Mar 2000 yodaiken@fsmlabs.com wrote:
<BR>
<P><EM>&gt;On a UP -- no change except code is more complex
</EM><BR>
<EM>&gt;On a SMP box  performance loss without using affinity.
</EM><BR>
<EM>&gt;        Take two spinlocks instead of one, more cache boucing etc.
</EM><BR>
<EM>&gt;One a SMP box using affinit  no gain over just using affinity
</EM><BR>
<EM>&gt;   except whn we assign edge interrupts for one cpu and level to 
</EM><BR>
<EM>&gt;   a second and even then it is hard to imagine that it does anything
</EM><BR>
<EM>&gt;   good. I think you are optimizing for a coner case of an 8 way box at
</EM><BR>
<EM>&gt;   the expense of everything else.
</EM><BR>
<P>The scaling is conceptually correct. There's no point to disallow an i8259
<BR>
irq to happen and to mask itself on CPU0 while an IO-APIC irq is masking
<BR>
itself in CPU1. They are completly orthogonal irqs.
<BR>
<P>If there's only one irq controller in the machine there's no gain and
<BR>
there's one more spinlock indeed.
<BR>
<P>BTW, affinity is not relevant to the scaling in IA32 where the CPU
<BR>
selection is done in hardware.
<BR>
<P>On alpha there are several types of IRQ each caming from a different
<BR>
source. So now the rtc irq can run irq_desc critical section in one CPU
<BR>
while another i8259-irq is masking itself in another CPU and while another
<BR>
dp264-pci-irq is masking itself in yet another CPU.
<BR>
<P>So I at least conceptually like the change since the irq.c code has to be
<BR>
generic.
<BR>
<P><EM>&gt;The second problem is this idea of blocking _all_ interrupts on an IOAPIC
</EM><BR>
<EM>&gt;during the execution of a level interrupt handler. This seems like a definite
</EM><BR>
<EM>&gt;performance loss on a dual SMP where one processor would otherwise be able
</EM><BR>
<EM>&gt;to take and service an irq while the other handleed a different irq. 
</EM><BR>
<P>I didn't checked the IO-APIC changes, but if that's true that's certainly
<BR>
not intentional and it has to be fixed.
<BR>
<P>Andrea
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0025.html">Andrea Arcangeli: "Re: new IRQ scalability changes in 2.3.48"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0023.html">Linus Torvalds: "Re: new IRQ scalability changes in 2.3.48"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0021.html">yodaiken@fsmlabs.com: "Re: new IRQ scalability changes in 2.3.48"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0012.html">Ingo Molnar: "Re: new IRQ scalability changes in 2.3.48"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0021.html">Andrea Arcangeli: "Re: new IRQ scalability changes in 2.3.48"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.www.fts.frontec.se/~dast/hypermail/">hypermail 2a22</A> 
: <EM>Sat Apr 01 2000 - 04:15:03 PST</EM>
</EM>
</SMALL>
</BODY>
</HTML>
